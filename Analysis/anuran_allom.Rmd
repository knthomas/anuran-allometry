---
title: "Analyses for: Eye-body allometry across biphasic ontogeny in anuran amphibians"
author: Sam Shrimpton & Kate Thomas
date: February 2021
output:
  html_document:
    theme: cerulean
    toc: TRUE
    toc_float: TRUE
    code_fold: hide
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}

#set rmarkdown options
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.height = 5, fig.width = 8, attr.output='style="max-height: 350px;"') 


#load libraries
library(plyr)
library(knitr)
library(kableExtra)
library(gridExtra)
library(ape)
library(geiger)
library(phytools)
library(evobiR)
library(plotly)
library(treeplyr)
library(MCMCglmm)
library(tidyverse)
library(cowplot)
library(smatr)
library(lme4)

```

# Data

## Morphological measurements

We measured transverse eye diameters (left and right), snout-vent length in tadpoles and adults, total length in tadpoles only, and wet mass for all specimens. 

```{r data}

# load raw morphological data
frogs_raw <- data.frame(read.csv("../Data/anuran_morph.csv", header=TRUE, na.strings=c("", "NA", " ", stringsAsFactors = FALSE))) 

# format data for analyses
frogs <- frogs_raw %>% 
  #remove spaces from genus columns
  mutate(Genus = gsub('\\s+', '', Genus)) %>%
  #remove spaces from species columns
  mutate(Species = gsub('\\s+', '', Species)) %>%
  #remove mass too small to be detected
  mutate(Wet_Mass = na_if(Wet_Mass, "<0.00")) %>% 
  #convert mass back to numeric format
  mutate(Wet_Mass = as.numeric(paste(Wet_Mass))) %>% 
  #make column for total wet mass adjusted by tag weight
  mutate(Mass = as.numeric(paste(Total_Weight))) %>%
  #use raw wet mass if tag adjusted mass not available
  mutate(Mass_est = ifelse(is.na(Mass), Wet_Mass, Mass)) %>%
  #take cube root of mass estimate
  mutate(rootmass_mass = as.numeric(Mass_est)^(1/3)) %>%
  #add genus_species
  mutate(genus_species = as.factor(paste(Genus, Species, sep = "_"))) %>% 
  #take mean of L/R eye size (if both measurements present)
  mutate(eyemean = rowMeans(frogs_raw[c('Eye_Diameter_Left_mm', 'Eye_Diameter_Right_mm')], na.rm=TRUE)) %>% 
  #make tadpole, metamorph, and adult categories based on Gosner stages (tadpole = 22-40, metamorphs = 41-45, adults = 46)
  mutate(gosner_category = case_when(Gosner_Scale <= 40 ~ "tadpole", Gosner_Scale >= 41 & Gosner_Scale <= 45 ~ "metamorph", Gosner_Scale == 46 ~ "adult"))
  
```

## Species sampling

Species were selected to reflect ecological and phylogenetic diversity. The number of individuals sampled varied depending on availability in the collections.

```{r sampling}

#compile number of frogs sampled by species
counts <-ddply(frogs, .(frogs$Order, frogs$Family, frogs$Genus, frogs$Species), nrow) 

#create table column names
names(counts) <- c("Order","Family", "Genus","Species","Sampled") 

#generate scrolling table in RMarkdown
kable(counts[ , c("Order", "Family","Genus","Species","Sampled")], caption = "Species and sampling effort for morphological data from museum specimens.") %>% 
                      kable_styling(full_width = F) %>% 
                      collapse_rows(columns = 1, valign = "top") %>%
                      scroll_box(height = "400px") 
```

## Anuran phylogeny

We used the phylogeny from Jetz and Pyron (2018) and pruned to our focal species. 

```{r load-phylo, include = FALSE}

#Import phylogeny from Jetz and Pyron 2019
tree_orig <- read.tree(file = "../Data/amph_shl_new_Consensus_7238.tre") #reads tree

#Import csv file with species, matching tips, and traits
traits <- data.frame(read.csv("../Data/frog_traits.csv", header=TRUE, na.strings=c("", "NA"))) 

#Force tip labels to read as characters (not factors)
traits$tiplabel_JetzPyron2019 <- as.character(traits$tiplabel_JetzPyron2019)

#make row names of the datafram the phylogeny tip labels
rownames(traits) <- traits$tiplabel_JetzPyron2019

#make list of taxa to drop (in tree but not in dataset)
drops <- setdiff(tree_orig$tip.label, traits$tiplabel_JetzPyron2019)

#drop unwanted tips from phylogeny
tree.pruned <- drop.tip(phy = tree_orig, tip = drops) 

#see which tips you've kept in your phylogeny
tree.pruned$tip.label

#reorder trait data to match phylogeny order
traits <-ReorderData(tree.pruned, traits, taxa.names="row names")

#check that phylogeny tips and data match exactly (if they match will return "OK")
name.check(tree.pruned, traits)

#check and reorder tree
is.rooted(tree.pruned) #tests whether tree is rooted (want it to return "TRUE") 
is.binary.tree(tree.pruned) #tests whether tree is dichotomous (no polytomies)
tree.pruned <- ladderize(tree.pruned) #ladderizes tree

#make tree ultrametric
tree.pruned <- chronopl(tree.pruned, 1)
```

```{r plot-phylo, fig.height=5, fig.width=5}

#plot tree of sampled species with original tip labels
plot.phylo(tree.pruned, #phylogeny to plot
           type = "phylogram", #how to visualize phylogeny
           show.tip.label = TRUE, #whether to show tip labels/species names
           cex = 1.0, #text size
           no.margin = TRUE, 
           use.edge.length = TRUE,
           edge.width = 1.5, #thickness of phylogeny branches
           label.offset = 0.1) #how far away from tips to put labels
```

# Eye-body developmental allometry in _Rana temporaria_

We used _Rana temporaria_ for higher-resolution ontogenetic sampling and life stage analysis because we had access to all Gosner stages and a good range of subadult and adult body sizes in the NHM collections. 

```{r Rana temporaria subset}

# Subset data by species --------
temporaria <- frogs %>% filter(genus_species=="Rana_temporaria")

# Make new column that includes subadults in staging
# tadpole = 22-40, metamorphs = 41-45, adults = 46, subadults = 46 (defined size range)
temporaria <- temporaria %>%
mutate(gosner_category2 = 
         case_when(gosner_category == "tadpole" ~ "tadpole",
                   gosner_category == "metamorph" ~ "metamorph",
                   gosner_category == "adult" & Snout.Vent_length <= 43 ~ "subadult",
                   gosner_category == "adult" & Snout.Vent_length > 43 ~ "mature adult"))

#Sample sizes --------

#remove missing data for this analysis
data <- temporaria %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category2), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

We used ordinary least-squares (OLS) regression as well as standardized major axis (SMA) regression to fit eye-body allometric data from _Rana temporaria_ and to test for differences in eye-body allometry between life stages, which were grouped into mature adults (Gosner stage 46, SVL > 43mm), subadults (Gosner stage 46, SVL â‰¤ 43 mm), metamorphs (Gosner stage 41-45), and tadpoles (Gosner stage 26-40).

## Eye scaling with snout-vent length (SVL)

We first examined the allometric relationship between log10 eye diameter and log10 snout-vent length. 

### SMA analysis
```{r Rana-eye-svl-SMA}


#Fit SMA regression  ---------

#SMA fit for mean eye diameter vs. snout-vent length
sma_eyesvl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category2,
            data = temporaria, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_eyesvl, which = "default",type = "o") 
plot(sma_eyesvl,which = "residual",type = "o")
plot(sma_eyesvl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_eyesvl)

#view pairwise comparisons
multcompmatrix(sma_eyesvl)

#save coefficients of fits as object
cc_eyesvltemp <- data.frame(coef(sma_eyesvl))

# Plot SMA results -------

#make color palette
cols <- c("mature adult" = "#009E73", 
          "subadult" = "mediumpurple1", 
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("mature adult" = 21, 
          "subadult" = 24, 
          "metamorph" = 22,
          "tadpole" = 23)

#make plot
temp_eyelength <- ggplot(temporaria, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category2, shape = gosner_category2, fill = gosner_category2)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_eyesvltemp, aes(intercept = cc_eyesvltemp[1,1], slope = cc_eyesvltemp[1,2]), linetype = "solid", color = cols["mature adult"]) + #adult
  #geom_abline(data=cc_eyesvltemp, aes(intercept=cc_eyesvltemp[2,1], slope = cc_eyesvltemp[2,2]), linetype = "dotted", color = cols["metamorph"]) + #metamorph (not significant)
  geom_abline(data = cc_eyesvltemp, aes(intercept = cc_eyesvltemp[3,1], slope = cc_eyesvltemp[3,2]), linetype = "dotted", color = cols["subadult"]) + #subadult
  geom_abline(data = cc_eyesvltemp, aes(intercept = cc_eyesvltemp[4,1], slope = cc_eyesvltemp[4,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole

#show plot
ggplotly(temp_eyelength)
```

### OLS analysis
```{r Rana-eye-svl-OLS}

#Fit OLS regression  ---------

#OLS fit for mean eye diameter vs. snout-vent length
ols_eyesvl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category2,
            data = temporaria) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_eyesvl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_eyesvl)

#view fits
summary(ols_eyesvl)

#confidence intervals
confint(ols_eyesvl, conf.level=0.95)


# Plot OLS results -------
#plot for OLS fits
rana_eyesvl <- ggplot(temporaria, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category2, shape = gosner_category2, fill = gosner_category2)) +
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                    breaks = c("mature adult", "subadult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)

ggplotly(rana_eyesvl)
```

## Eye scaling with body mass

Then we used the same methods (OLS and SMA) to examine how eye diameter scales with the cube root of body mass across life stages. 

```{r}
#Sample sizes --------

#remove missing data for this analysis
data <- temporaria %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category2), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

### SMA analysis

```{r Rana-eye-mass-SMA}

#Fit SMA model ---------

#SMA fit for mean eye diameter vs. mass
sma_eyemass <- sma(formula = eyemean ~ rootmass_mass * gosner_category2,
            data = temporaria, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_eyemass, which = "default",type = "o") 
plot(sma_eyemass,which = "residual",type = "o")
plot(sma_eyemass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_eyemass)

#view pairwise comparisons
multcompmatrix(sma_eyemass)

#save coefficients of fits as object
cc_eyemasstemp <- data.frame(coef(sma_eyemass))

# Plot results -------

#make plot
temp_eyemass <- ggplot(temporaria, aes(x = rootmass_mass, y = eyemean, color = gosner_category2, shape = gosner_category2, fill = gosner_category2)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) +
  scale_shape_manual(values=c(21, 24, 22, 23), name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_eyemasstemp, aes(intercept = cc_eyemasstemp[1,1], slope = cc_eyemasstemp[1,2]), linetype = "solid", color = cols["mature adult"]) + #adult
  geom_abline(data = cc_eyemasstemp, aes(intercept = cc_eyemasstemp[2,1], slope = cc_eyemasstemp[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_eyemasstemp, aes(intercept = cc_eyemasstemp[3,1], slope = cc_eyemasstemp[3,2]), linetype = "dotted", color = cols["subadult"]) + #subadult
  geom_abline(data = cc_eyemasstemp, aes(intercept = cc_eyemasstemp[4,1], slope = cc_eyemasstemp[4,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole

#show plot
ggplotly(temp_eyemass)
```

### OLS analysis
```{r Rana-eye-mass-OLS}

#Fit OLS regression  ---------

#OLS fit for mean eye diameter vs. snout-vent length
ols_eyemass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category2,
            data = temporaria) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_eyemass)
par(mfrow = c(1,1)) 

##overall significance of effects
anova(ols_eyemass)

#view fits
summary(ols_eyemass)

#confidence intervals
confint(ols_eyemass, conf.level=0.95)


# Plot OLS results -------
#plot for OLS fits
rana_eyemass <- ggplot(temporaria, aes(x = rootmass_mass, y = eyemean, color = gosner_category2, shape = gosner_category2, fill = gosner_category2)) +
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                    breaks = c("mature adult", "subadult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("mature adult", "subadult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)

ggplotly(rana_eyemass)

```

## Figures of _R. temporaria_ eye allometry


### Figure 1
```{r Figure-1-OLS, fig.width = 8, fig.height=4, results = "hide"}

# edit original plots to make them nicer panels for figure
a <- rana_eyemass +
  ggtitle("") +
  theme(legend.position = "none")

b <- rana_eyesvl +
  ggtitle("") +
   theme(legend.position = "none")

# arrange plots in panels
plots <- plot_grid(a, b,  #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           labels = c("A", "B"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           ncol = 2) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="right"))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 2, rel_widths = c(1, .2), align = 'vh')

#export figure
png("../Figures/Figure-1.png", width = 8, height = 4, units = "in", res = 500)
plot_grid(plots, leg, ncol = 2, rel_widths = c(1, .2), align = 'vh')
dev.off()
```

### Figure S1
```{r Figure-S1-SMA, fig.width = 8, fig.height=4, results = "hide"}

# edit original SMA fit plots to make them nicer panels for figure
a <- temp_eyemass +
  ggtitle("") +
  theme(legend.position = "none")

b <- temp_eyelength +
  ggtitle("") +
   theme(legend.position = "none")

# arrange plots in panels
plots <- plot_grid(a, b,  #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           labels = c("A", "B"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           ncol = 2) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="right"))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 2, rel_widths = c(1, .2), align = 'vh')

#export figure
png("../Figures/Figure-S1.png", width = 8, height = 4, units = "in", res = 500)
plot_grid(plots, leg, ncol = 2, rel_widths = c(1, .2), align = 'vh')
dev.off()
```

# Eye-body developmental allometry in other anuran species

We then looked at eye-body allometry for 11 other anuran species and compared these to _Rana temporaria_. Because only _Rana temporaria_ had published data on the approximate size transition from subadult to adult, and because our sampling was less robust in the 11 other species, we limited our life stage groups to three stages: tadpole (Gosner stages 22-40), metamorph (Gosner stages 41-45), and adult (Gosner stage 46).

Again, we have fit data using both SMA regression and OLS regression. SMA line fits for metamorphs (and all groups) are displayed in plots only if the data for that group were significantly correlated (p<0.05). 
```{r species-subsets}

#subset data by species
rana <- frogs %>% filter(genus_species == "Rana_temporaria")
trichobatrachus <- frogs %>% filter(genus_species == "Trichobatrachus_robustus")
bufo <- frogs %>% filter(genus_species == "Bufo_bufo")
aubria <- frogs %>% filter(genus_species == "Aubria_subsigillata")
pseudis <- frogs %>% filter(genus_species == "Pseudis_paradoxa")
xenopus <- frogs %>% filter(genus_species == "Xenopus_victorianus")
polypedates <- frogs %>% filter(genus_species == "Polypedates_leucomystax")
hyla <- frogs %>% filter(genus_species == "Hyla_meridionalis")
leptopelis <- frogs %>% filter(genus_species == "Leptopelis_spiritusnoctis")
microhyla <- frogs %>% filter(genus_species == "Microhyla_rubra")
kaloula <- frogs %>% filter(genus_species == "Kaloula_pulchra")
hemisus <- frogs %>% filter(genus_species == "Hemisus_marmoratus")

#compile number of each stage sampled by species
counts <-ddply(frogs, .(frogs$genus_species, frogs$gosner_category), nrow) 

#create table column names
names(counts) <- c("Species", "Stage", "Sampled") 

#generate scrolling table in RMarkdown
kable(counts[ , c("Species","Stage","Sampled")], caption = "Sample numbers for each stage by species") %>% 
                      kable_styling(full_width = F) %>% 
                      collapse_rows(columns = 1, valign = "top") %>%
                      scroll_box(height = "400px") 
```

## Eye scaling with SVL

We first fit SMA and OLS regressions for eye diameter by snout-vent length for all 12 species (including _Rana temporaria_ with reduced group levels) and tested for slope and/or intercept differences across life stages. 

### _Rana temporaria_
```{r}
#remove missing data for this analysis
data <- rana %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts

```

#### SMA fits
```{r SMAs-SVL-Rana}

#SMA models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)


sma_rana.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = rana, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_rana.svl, which = "default",type = "o") 
plot(sma_rana.svl,which = "residual",type = "o")
plot(sma_rana.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_rana.svl)

#view pairwise comparisons
multcompmatrix(sma_rana.svl)

#save coefficients of fits as object
cc_rana.svl <- data.frame(coef(sma_rana.svl))

#make plot
plot_rana.svl <- ggplot(rana, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_rana.svl, aes(intercept = cc_rana.svl[1,1], slope = cc_rana.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_rana.svl, aes(intercept = cc_rana.svl[2,1], slope = cc_rana.svl[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_rana.svl, aes(intercept = cc_rana.svl[3,1], slope = cc_rana.svl[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole

```

#### OLS fits
```{r OLS-SVL-Rana}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_rana.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = rana) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_rana.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_rana.svl)

#view fits
summary(ols_rana.svl)

#confidence intervals
confint(ols_rana.svl, conf.level=0.95)


#make plot
plot_rana.svl.ols <- ggplot(rana, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Xenopus victorianus_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- xenopus %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-SVL-Xenopus}

# SMA model
#note: only 1 metamorph so only included tadpoles and adults
sma_xenopus.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category, 
            data = xenopus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_xenopus.svl, which = "default",type = "o") 
plot(sma_xenopus.svl,which = "residual",type = "o")
plot(sma_xenopus.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_xenopus.svl)

#save coefficients of fits as object
cc_xenopus.svl <- data.frame(coef(sma_xenopus.svl))

#make plot
plot_xenopus.svl <- ggplot(xenopus, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Xenopus victorianus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_xenopus.svl, aes(intercept = cc_xenopus.svl[1,1], slope = cc_xenopus.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adults
  geom_abline(data = cc_xenopus.svl, aes(intercept = cc_xenopus.svl[2,1], slope = cc_xenopus.svl[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits

```{r OLS-SVL-Xenopus}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_xenopus.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = xenopus) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_xenopus.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_xenopus.svl)

#view fits
summary(ols_xenopus.svl)

#confidence intervals
confint(ols_xenopus.svl, conf.level=0.95)

#make plot
plot_xenopus.svl.ols <- ggplot(xenopus, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Xenopus victorianus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Trichobatrachus robustus_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- trichobatrachus %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-SVL-Trichobatrachus}
# SMA fits
sma_trichobatrachus.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = trichobatrachus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_trichobatrachus.svl, which = "default",type = "o") 
plot(sma_trichobatrachus.svl,which = "residual",type = "o")
plot(sma_trichobatrachus.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_trichobatrachus.svl)

#view pairwise comparisons
multcompmatrix(sma_trichobatrachus.svl)

#save coefficients of fits as object
cc_trichobatrachus.svl <- data.frame(coef(sma_trichobatrachus.svl))

#since slopes are equal, test for differences in intercepts
sma_trichobatrachus_el.svl <- sma(formula = eyemean ~ Snout.Vent_length + gosner_category,
            data = trichobatrachus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#results
summary(sma_trichobatrachus_el.svl)
multcompmatrix(sma_trichobatrachus_el.svl)
cc_trichobatrachus_el.svl <- data.frame(coef(sma_trichobatrachus_el.svl))

#make plot
plot_trichobatrachus.svl <- ggplot(trichobatrachus, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Trichobatrachus robustus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_trichobatrachus.svl, aes(intercept = cc_trichobatrachus.svl[1,1], slope = cc_trichobatrachus.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_trichobatrachus.svl, aes(intercept = cc_trichobatrachus.svl[2,1], slope = cc_trichobatrachus.svl[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_trichobatrachus.svl, aes(intercept = cc_trichobatrachus.svl[3,1], slope = cc_trichobatrachus.svl[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-SVL-Trichobatrachus}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_trichobatrachus.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = trichobatrachus) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_trichobatrachus.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_trichobatrachus.svl)

#view fits
summary(ols_trichobatrachus.svl)

#confidence intervals
confint(ols_trichobatrachus.svl, conf.level=0.95)

#make plot
plot_trichobatrachus.svl.ols <- ggplot(trichobatrachus, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Trichobatrachus robustus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Bufo bufo_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- bufo %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-SVL-Bufo}
# SMA model
sma_bufo.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = bufo, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_bufo.svl, which = "default",type = "o") 
plot(sma_bufo.svl,which = "residual",type = "o")
plot(sma_bufo.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_bufo.svl)

#view pairwise comparisons
print(sma_bufo.svl)
multcompmatrix(sma_bufo.svl)

#save coefficients of fits as object
cc_bufo.svl <- data.frame(coef(sma_bufo.svl))

#make plot
plot_bufo.svl <- ggplot(bufo, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Bufo bufo") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_bufo.svl, aes(intercept = cc_bufo.svl[1,1], slope = cc_bufo.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_bufo.svl, aes(intercept = cc_bufo.svl[2,1], slope = cc_bufo.svl[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_bufo.svl, aes(intercept = cc_bufo.svl[3,1], slope = cc_bufo.svl[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-SVL-Bufo}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_bufo.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = bufo) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_bufo.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_bufo.svl)

#view fits
summary(ols_bufo.svl)

#confidence intervals
confint(ols_bufo.svl, conf.level=0.95)

#make plot
plot_bufo.svl.ols <- ggplot(bufo, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Bufo bufo") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Aubria subsigillata_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- aubria %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-SVL-Aubria}
# SMA model
# note: only 1 metamorph so only tadpole and adult groups included in SMA
sma_aubria.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = aubria, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_aubria.svl, which = "default",type = "o") 
plot(sma_aubria.svl,which = "residual",type = "o")
plot(sma_aubria.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_aubria.svl)

#save coefficients of fits as object
cc_aubria.svl <- data.frame(coef(sma_aubria.svl))

#make plot
plot_aubria.svl <- ggplot(aubria, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Aubria subsigillata") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_aubria.svl, aes(intercept = cc_aubria.svl[1,1], slope = cc_aubria.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_aubria.svl, aes(intercept = cc_aubria.svl[2,1], slope = cc_aubria.svl[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole

```

#### OLS fits
```{r OLS-SVL-Aubria}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_aubria.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = aubria) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_aubria.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_aubria.svl)

#view fits
summary(ols_aubria.svl)

#confidence intervals
confint(ols_aubria.svl, conf.level=0.95)

#make plot
plot_aubria.svl.ols <- ggplot(aubria, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Aubria subsigillata") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Pseudis paradoxa_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- pseudis %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts

```

#### SMA fits
```{r SMAs-SVL-Pseudis}

# SMA model of eye diameter vs. snout-vent length
sma_pseudis.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = pseudis, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_pseudis.svl, which = "default",type = "o") 
plot(sma_pseudis.svl,which = "residual",type = "o")
plot(sma_pseudis.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_pseudis.svl)

#view pairwise comparisons
multcompmatrix(sma_pseudis.svl)

#save coefficients of fits as object
cc_pseudis.svl <- data.frame(coef(sma_pseudis.svl))

#since slopes are same among groups, test for difference in elevation
sma_pseudis_el.svl <- sma(formula = eyemean ~ Snout.Vent_length + gosner_category,
            data = pseudis, 
            log = "xy", #sets both x and y variables as logged
            method ="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 
#show results
print(sma_pseudis_el.svl)
summary(sma_pseudis_el.svl)
multcompmatrix(sma_pseudis_el.svl)

#make plot
plot_pseudis.svl <- ggplot(pseudis, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Pseudis paradoxa") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_pseudis.svl, aes(intercept = cc_pseudis.svl[1,1], slope = cc_pseudis.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_pseudis.svl, aes(intercept = cc_pseudis.svl[2,1], slope = cc_pseudis.svl[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_pseudis.svl, aes(intercept = cc_pseudis.svl[3,1], slope = cc_pseudis.svl[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole

```

#### OLS fits
```{r OLS-SVL-Pseudis}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_pseudis.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = pseudis) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_pseudis.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_pseudis.svl)

#view fits
summary(ols_pseudis.svl)

#confidence intervals
confint(ols_pseudis.svl, conf.level=0.95)

#make plot
plot_pseudis.svl.ols <- ggplot(pseudis, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Pseudis paradoxa") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Polypedates leucomystax_
```{r}
#Sample sizes --------

#remove missing data for this analysis
data <- polypedates %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts

```

#### SMA fits
```{r SMAs-SVL-Polypedates}

# SMA model of eye diameter vs. snout-vent length
sma_polypedates.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = polypedates, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_polypedates.svl, which = "default",type = "o") 
plot(sma_polypedates.svl,which = "residual",type = "o")
plot(sma_polypedates.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_polypedates.svl)

#view pairwise comparisons
multcompmatrix(sma_polypedates.svl)

#save coefficients of fits as object
cc_polypedates.svl <- data.frame(coef(sma_polypedates.svl))

#make plot
plot_polypedates.svl <- ggplot(polypedates, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Polypedates leucomystax") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_polypedates.svl, aes(intercept = cc_polypedates.svl[1,1], slope = cc_polypedates.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_polypedates.svl, aes(intercept = cc_polypedates.svl[2,1], slope = cc_polypedates.svl[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_polypedates.svl, aes(intercept = cc_polypedates.svl[3,1], slope = cc_polypedates.svl[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-SVL-Polypedates}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_polypedates.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = polypedates) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_polypedates.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_polypedates.svl)

#view fits
summary(ols_polypedates.svl)

#confidence intervals
confint(ols_polypedates.svl, conf.level=0.95)

#make plot
plot_polypedates.svl.ols <- ggplot(polypedates, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Polypedates leucomystax") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Hyla meridionalis_
```{r}
#Sample sizes --------

#remove missing data for this analysis
data <- hyla %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA analysis
```{r SMAs-SVL-Hyla}



# Hyla meridionalis--------------
sma_hyla.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = hyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_hyla.svl, which = "default",type = "o") 
plot(sma_hyla.svl,which = "residual",type = "o")
plot(sma_hyla.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_hyla.svl)

#view pairwise comparisons
multcompmatrix(sma_hyla.svl)

#save coefficients of fits as object
cc_hyla.svl <- data.frame(coef(sma_hyla.svl))

#since slopes are equal among groups, test for difference in elevation
sma_hyla_el.svl <- sma(formula = eyemean ~ Snout.Vent_length + gosner_category,
            data = hyla, 
            log = "xy", #sets both x and y variables as logged
            method ="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 
#show results
print(sma_hyla_el.svl)
summary(sma_hyla_el.svl)
multcompmatrix(sma_hyla_el.svl)

#make plot
plot_hyla.svl <- ggplot(hyla, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Hyla meridionalis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_hyla.svl, aes(intercept = cc_hyla.svl[1,1], slope = cc_hyla.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_hyla.svl, aes(intercept = cc_hyla.svl[2,1], slope = cc_hyla.svl[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_hyla.svl, aes(intercept = cc_hyla.svl[3,1], slope = cc_hyla.svl[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-SVL-Hyla}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_hyla.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = hyla) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_hyla.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_hyla.svl)

#view fits
summary(ols_hyla.svl)

#confidence intervals
confint(ols_hyla.svl, conf.level=0.95)

#make plot
plot_hyla.svl.ols <- ggplot(hyla, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Hyla meridionalis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Leptopelis spiritusnoctis_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- leptopelis %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA analysis
```{r SMAs-SVL-Leptopelis}

# SMA model of eye diameter vs. snout-vent length
# note: 0 metamorphs so only tadpole and adult groups included in SMA
sma_leptopelis.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = leptopelis, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_leptopelis.svl, which = "default",type = "o") 
plot(sma_leptopelis.svl,which = "residual",type = "o")
plot(sma_leptopelis.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_leptopelis.svl)

#save coefficients of fits as object
cc_leptopelis.svl <- data.frame(coef(sma_leptopelis.svl))

#make plot
plot_leptopelis.svl <- ggplot(leptopelis, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Leptopelis spiritusnoctis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_leptopelis.svl, aes(intercept = cc_leptopelis.svl[1,1], slope = cc_leptopelis.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_leptopelis.svl, aes(intercept = cc_leptopelis.svl[2,1], slope = cc_leptopelis.svl[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-SVL-Leptopelis}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_leptopelis.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = leptopelis) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_leptopelis.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_leptopelis.svl)

#view fits
summary(ols_leptopelis.svl)

#confidence intervals
confint(ols_leptopelis.svl, conf.level=0.95)

#make plot
plot_leptopelis.svl.ols <- ggplot(leptopelis, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Leptopelis spiritusnoctis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Microhyla rubra_
```{r}
#Sample sizes 
#remove missing data for this analysis
data <- microhyla %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-SVL-Microhyla}
# SMA model
# note: only 1 metamorph so only tadpole and adult groups included in SMA
sma_microhyla.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = microhyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_microhyla.svl, which = "default",type = "o") 
plot(sma_microhyla.svl,which = "residual",type = "o")
plot(sma_microhyla.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_microhyla.svl)

#save coefficients of fits as object
cc_microhyla.svl <- data.frame(coef(sma_microhyla.svl))

#test for difference in intercepts
sma_microhyla.svl_el <- sma(formula = eyemean ~ Snout.Vent_length + gosner_category,
            data = microhyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#view fits
summary(sma_microhyla.svl_el)

#make plot
plot_microhyla.svl <- ggplot(microhyla, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Microhyla rubra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_microhyla.svl, aes(intercept = cc_microhyla.svl[1,1], slope = cc_microhyla.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_microhyla.svl, aes(intercept = cc_microhyla.svl[2,1], slope = cc_microhyla.svl[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-SVL-Microhyla}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_microhyla.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = microhyla) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_microhyla.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_microhyla.svl)

#view fits
summary(ols_microhyla.svl)

#confidence intervals
confint(ols_microhyla.svl, conf.level=0.95)

#make plot
plot_microhyla.svl.ols <- ggplot(microhyla, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Microhyla rubra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Kaloula pulchra_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- kaloula %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

### SMA fits
```{r SMAs-SVL-Kaloula}

# SMA model
sma_kaloula.svl  <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = kaloula, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_kaloula.svl, which = "default",type = "o") 
plot(sma_kaloula.svl,which = "residual",type = "o")
plot(sma_kaloula.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_kaloula.svl)

#view pairwise comparisons
multcompmatrix(sma_kaloula.svl)

#save coefficients of fits as object
cc_kaloula.svl <- data.frame(coef(sma_kaloula.svl))

#make plot
plot_kaloula.svl <- ggplot(kaloula, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Kaloula pulchra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_kaloula.svl, aes(intercept = cc_kaloula.svl[1,1], slope = cc_kaloula.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_kaloula.svl, aes(intercept = cc_kaloula.svl[2,1], slope = cc_kaloula.svl[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_kaloula.svl, aes(intercept = cc_kaloula.svl[3,1], slope = cc_kaloula.svl[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-SVL-Kaloula}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_kaloula.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = kaloula) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_kaloula.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_kaloula.svl)

#view fits
summary(ols_kaloula.svl)

#confidence intervals
confint(ols_kaloula.svl, conf.level=0.95)

#make plot
plot_kaloula.svl.ols <- ggplot(kaloula, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Kaloula pulchra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Hemisus marmoratus_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- hemisus %>% drop_na(Snout.Vent_length) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-SVL-Hemisus}
#SMA model for eye diameter vs. snout-vent length
sma_hemisus.svl <- sma(formula = eyemean ~ Snout.Vent_length * gosner_category,
            data = hemisus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_hemisus.svl, which = "default",type = "o") 
plot(sma_hemisus.svl,which = "residual",type = "o")
plot(sma_hemisus.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_hemisus.svl)

#view pairwise comparisons
multcompmatrix(sma_hemisus.svl)

#save coefficients of fits as object
cc_hemisus.svl <- data.frame(coef(sma_hemisus.svl))

#make plot
plot_hemisus.svl <- ggplot(hemisus, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Hemisus marmoratus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_hemisus.svl, aes(intercept = cc_hemisus.svl[1,1], slope = cc_hemisus.svl[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_hemisus.svl, aes(intercept = cc_hemisus.svl[2,1], slope = cc_hemisus.svl[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_hemisus.svl, aes(intercept = cc_hemisus.svl[3,1], slope = cc_hemisus.svl[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-SVL-Hemisus}

#OLS models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_hemisus.svl <- lm(formula = log10(eyemean) ~ log10(Snout.Vent_length) * gosner_category,
            data = hemisus) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_hemisus.svl)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_hemisus.svl)

#view fits
summary(ols_hemisus.svl)

#confidence intervals
confint(ols_hemisus.svl, conf.level=0.95)

#make plot
plot_hemisus.svl.ols <- ggplot(hemisus, aes(x = Snout.Vent_length, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "SVL (mm))") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Hemisus marmoratus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### Figures for eye scaling with SVL

#### Figure S4

```{r Figure-S4-SMA, fig.height = 8, fig.width = 8, results = "hide"}

# edit original plots to make them nicer panels for figure
a <- plot_rana.svl +
  ggtitle(expression(paste(italic("Rana temporaria"),"*"))) + 
  theme(legend.position = "none") + 
  scale_x_log10(" ") +
  scale_y_log10("Eye diameter (mm)")

f <- plot_xenopus.svl +
  ggtitle(expression(paste(italic("Xenopus victorianus"),"*"))) +
  theme(legend.position = "none") + 
  scale_x_log10(" ") + 
  scale_y_log10(" ")

c <- plot_bufo.svl +
  ggtitle(expression(paste(italic("Bufo bufo"),"*"))) +
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ")

d <- plot_aubria.svl +
  ggtitle(expression(paste(italic("Aubria subsigillata"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10(" ") +
  scale_y_log10("Eye diameter (mm)") 

e <- plot_pseudis.svl +
  ggtitle(expression(paste(italic("Pseudis paradoxa")^"â€ "))) + 
  theme(legend.position = "none") +
  scale_x_log10(" ") +
  scale_y_log10(" ") 

j <- plot_microhyla.svl +
  ggtitle(expression(paste(italic("Microhyla rubra")^"â€ "))) + 
  theme(legend.position = "none") +
  scale_x_log10("SVL (mm)") + 
  scale_y_log10("Eye diameter (mm)") 

h <- plot_hyla.svl +
  ggtitle(expression(paste(italic("Hyla meridionalis")^"â€ "))) + 
  theme(legend.position = "none") +
  scale_x_log10(" ") +
  scale_y_log10(" ")

g <- plot_polypedates.svl +
  ggtitle(expression(paste(italic("Polypedates leucomystax"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10("") + 
  scale_y_log10("Eye diameter (mm)")

b <- plot_trichobatrachus.svl +
  ggtitle(expression(paste(italic("Trichobatrachus robustus")^"â€ "))) + 
  theme(legend.position = "none") +
  scale_x_log10("") +
  scale_y_log10(" ") 

k <- plot_kaloula.svl +
  ggtitle(expression(paste(italic("Kaloula pulchra"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10("SVL (mm)") + 
  scale_y_log10(" ") 

i <- plot_leptopelis.svl +
  ggtitle(expression(paste(italic("Leptopelis spiritusnoctis"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10(" ") +
  scale_y_log10(" ")

l <- plot_hemisus.svl +
  ggtitle(expression(paste(italic("Hemisus marmoratus"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10("SVL (mm)") + 
  scale_y_log10(" ") 

# arrange plots in panels
plots <- plot_grid( a, b, c, d, e, f, g, h, i, j, k, l, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           axis = 'lb',
           labels = c("A", "B", "C", "D", "E", "F", "G", "H", "I","J", "K", "L"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           nrow = 4) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="bottom"))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1))

#export figure
png("../Figures/Figure-S4.png", width = 10, height = 10, units = "in", res = 500)
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1), align = 'vh')
dev.off()
```

#### Figure S3

```{r Figure-S3-OLS, fig.height = 8, fig.width = 8, results = "hide"}

# edit original plots to make them nicer panels for figure
a <- plot_rana.svl.ols +
  ggtitle(expression(paste(italic("Rana temporaria"),"*"))) + 
  theme(legend.position = "none") + 
  scale_x_log10(" ") +
  scale_y_log10("Eye diameter (mm)")

f <- plot_xenopus.svl.ols +
  ggtitle(expression(paste(italic("Xenopus victorianus"),"*"))) +
  theme(legend.position = "none") + 
  scale_x_log10(" ") + 
  scale_y_log10(" ")

c <- plot_bufo.svl.ols +
  ggtitle(expression(paste(italic("Bufo bufo"),"*"))) +
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ")

d <- plot_aubria.svl.ols +
  ggtitle(expression(paste(italic("Aubria subsigillata"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10(" ") +
  scale_y_log10("Eye diameter (mm)") 

e <- plot_pseudis.svl.ols +
  ggtitle(expression(paste(italic("Pseudis paradoxa"),"*"))) + 
  theme(legend.position = "none") +
  scale_x_log10(" ") +
  scale_y_log10(" ") 

j <- plot_microhyla.svl.ols +
  ggtitle(expression(paste(italic("Microhyla rubra"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10("SVL (mm)") + 
  scale_y_log10("Eye diameter (mm)") 

h <- plot_hyla.svl.ols +
  ggtitle(expression(paste(italic("Hyla meridionalis"),""))) + 
  theme(legend.position = "none") +
  scale_x_log10(" ") +
  scale_y_log10(" ")

g <- plot_polypedates.svl.ols +
  ggtitle(expression(paste(italic("Polypedates leucomystax"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10("") + 
  scale_y_log10("Eye diameter (mm)")

b <- plot_trichobatrachus.svl.ols +
  ggtitle(expression(paste(italic("Trichobatrachus robustus")^""))) + 
  theme(legend.position = "none") +
  scale_x_log10("") +
  scale_y_log10(" ") 

k <- plot_kaloula.svl.ols +
  ggtitle(expression(paste(italic("Kaloula pulchra"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10("SVL (mm)") + 
  scale_y_log10(" ") 

i <- plot_leptopelis.svl.ols +
  ggtitle(expression(paste(italic("Leptopelis spiritusnoctis"),"*"))) +
  theme(legend.position = "none") +
  scale_x_log10(" ") +
  scale_y_log10(" ")

l <- plot_hemisus.svl.ols +
  ggtitle(expression(paste(italic("Hemisus marmoratus"),""))) +
  theme(legend.position = "none") +
  scale_x_log10("SVL (mm)") + 
  scale_y_log10(" ") 

# arrange plots in panels
plots <- plot_grid( a, b, c, d, e, f, g, h, i, j, k, l, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           axis = 'lb',
           labels = c("A", "B", "C", "D", "E", "F", "G", "H", "I","J", "K", "L"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           nrow = 4) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="bottom"))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1))

#export figure
png("../Figures/Figure-S3.png", width = 10, height = 10, units = "in", res = 500)
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1), align = 'vh')
dev.off()
```


## Eye scaling with body mass

We fit SMA and OLS regressions for eye diameter vs the cube root of mass for all 12 species (including _Rana temporaria_ with reduced group levels) and tested for slope and/or intercept differences across life stages. In these analyses, wet mass was corrected by the weight of the accession tag. 

### _Rana temporaria_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- rana %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Rana}

#SMA models for eye diameter vs. cube root of mass
sma_rana.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = rana, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_rana.mass, which = "default",type = "o") 
plot(sma_rana.mass,which = "residual",type = "o")
plot(sma_rana.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_rana.mass)

#view pairwise comparisons
multcompmatrix(sma_rana.mass)

#save coefficients of fits as object
cc_rana.mass <- data.frame(coef(sma_rana.mass))

#make plot
plot_rana.mass <- ggplot(rana, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_rana.mass, aes(intercept = cc_rana.mass[1,1], slope = cc_rana.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_rana.mass, aes(intercept = cc_rana.mass[2,1], slope = cc_rana.mass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_rana.mass, aes(intercept = cc_rana.mass[3,1], slope = cc_rana.mass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Rana}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_rana.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = rana) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_rana.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_rana.mass)

#view fits
summary(ols_rana.mass)

#confidence intervals
confint(ols_rana.mass, conf.level=0.95)

#make plot
plot_rana.mass.ols <- ggplot(rana, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Xenopus victorianus_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- xenopus %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts

```

#### SMA fits
```{r SMAs-mass-Xenopus}
# SMA model
#note: only 1 metamorph so only included tadpoles and adults
sma_xenopus.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category, 
            data = xenopus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_xenopus.mass, which = "default",type = "o") 
plot(sma_xenopus.mass,which = "residual",type = "o")
plot(sma_xenopus.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_xenopus.mass)

#save coefficients of fits as object
cc_xenopus.mass <- data.frame(coef(sma_xenopus.mass))

#since slopes not significantly different, test intercepts
sma_xenopus.mass2 <- sma(formula = eyemean ~ rootmass_mass + gosner_category, 
            data = xenopus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#print results
summary(sma_xenopus.mass2)

#make plot
plot_xenopus.mass <- ggplot(xenopus, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Xenopus victorianus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_xenopus.mass, aes(intercept = cc_xenopus.mass[1,1], slope = cc_xenopus.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_xenopus.mass, aes(intercept = cc_xenopus.mass[2,1], slope = cc_xenopus.mass[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Xenopus}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_xenopus.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = xenopus) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_xenopus.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_xenopus.mass)

#view fits
summary(ols_xenopus.mass)

#confidence intervals
confint(ols_xenopus.mass, conf.level=0.95)


#make plot
plot_xenopus.mass.ols <- ggplot(xenopus, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Xenopus victorianus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Trichobatrachus robustus_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- trichobatrachus %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Trichobatrachus}
#SMA model
sma_trichobatrachus.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = trichobatrachus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_trichobatrachus.mass, which = "default",type = "o") 
plot(sma_trichobatrachus.mass,which = "residual",type = "o")
plot(sma_trichobatrachus.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_trichobatrachus.mass)

#view pairwise comparisons
multcompmatrix(sma_trichobatrachus.mass)

#save coefficients of fits as object
cc_trichobatrachus.mass <- data.frame(coef(sma_trichobatrachus.mass))

#as slopes are equal, test for difference in intercepts
sma_trichobatrachus_el.mass <- sma(formula = eyemean ~ rootmass_mass + gosner_category,
            data = trichobatrachus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#view results
summary(sma_trichobatrachus_el.mass)

#make plot
plot_trichobatrachus.mass <- ggplot(trichobatrachus, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Trichobatrachus robustus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_trichobatrachus.mass, aes(intercept = cc_trichobatrachus.mass[1,1], slope = cc_trichobatrachus.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_trichobatrachus.mass, aes(intercept = cc_trichobatrachus.mass[2,1], slope = cc_trichobatrachus.mass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_trichobatrachus.mass, aes(intercept = cc_trichobatrachus.mass[3,1], slope = cc_trichobatrachus.mass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Trichobatrachus}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_trichobatrachus.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = trichobatrachus) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_trichobatrachus.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_trichobatrachus.mass)

#view fits
summary(ols_trichobatrachus.mass)

#confidence intervals
confint(ols_trichobatrachus.mass, conf.level=0.95)


#make plot
plot_trichobatrachus.mass.ols <- ggplot(trichobatrachus, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Trichobatrachus robustus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Bufo bufo_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- bufo %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Bufo}
#SMA model
sma_bufo.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = bufo, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_bufo.mass, which = "default",type = "o") 
plot(sma_bufo.mass,which = "residual",type = "o")
plot(sma_bufo.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_bufo.mass)

#view pairwise comparisons
multcompmatrix(sma_bufo.mass)

#save coefficients of fits as object
cc_bufo.mass <- data.frame(coef(sma_bufo.mass))

#make plot
plot_bufo.mass <- ggplot(bufo, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Bufo bufo") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_bufo.mass, aes(intercept = cc_bufo.mass[1,1], slope = cc_bufo.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_bufo.mass, aes(intercept = cc_bufo.mass[2,1], slope = cc_bufo.mass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_bufo.mass, aes(intercept = cc_bufo.mass[3,1], slope = cc_bufo.mass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Bufo}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_bufo.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = bufo) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_bufo.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_bufo.mass)

#view fits
summary(ols_bufo.mass)

#confidence intervals
confint(ols_bufo.mass, conf.level=0.95)

#make plot
plot_bufo.mass.ols <- ggplot(bufo, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Bufo bufo") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Aubria subsigillata_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- aubria %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Aubria}
#SMA model
# note: only 1 metamorph so only tadpole and adult groups included in SMA
sma_aubria.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = aubria, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_aubria.mass, which = "default",type = "o") 
plot(sma_aubria.mass,which = "residual",type = "o")
plot(sma_aubria.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_aubria.mass)

#save coefficients of fits as object
cc_aubria.mass <- data.frame(coef(sma_aubria.mass))

#make plot
plot_aubria.mass <- ggplot(aubria, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Aubria subsigillata") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_aubria.mass, aes(intercept = cc_aubria.mass[1,1], slope = cc_aubria.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_aubria.mass, aes(intercept = cc_aubria.mass[2,1], slope = cc_aubria.mass[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Aubria}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_aubria.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = aubria) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_aubria.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_aubria.mass)

#view fits
summary(ols_aubria.mass)

#confidence intervals
confint(ols_aubria.mass, conf.level=0.95)

#make plot
plot_aubria.mass.ols <- ggplot(aubria, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Aubria subsigillata") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Pseudis paradoxa_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- pseudis %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts

```

#### SMA fits
```{r SMAs-mass-Pseudis}
#SMA model
sma_pseudis.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = pseudis, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_pseudis.mass, which = "default",type = "o") 
plot(sma_pseudis.mass,which = "residual",type = "o")
plot(sma_pseudis.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_pseudis.mass)

#view pairwise comparisons
multcompmatrix(sma_pseudis.mass)

#save coefficients of fits as object
cc_pseudis.mass <- data.frame(coef(sma_pseudis.mass))

#since slopes are same among groups, test for difference in elevation
sma_pseudis_el.mass <- sma(formula = eyemean ~ rootmass_mass + gosner_category,
            data = pseudis, 
            log = "xy", #sets both x and y variables as logged
            method ="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05)

#show results
print(sma_pseudis_el.mass)
summary(sma_pseudis_el.mass)
multcompmatrix(sma_pseudis_el.mass)

#make plot
plot_pseudis.mass <- ggplot(pseudis, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Pseudis paradoxa") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_pseudis.mass, aes(intercept = cc_pseudis.mass[1,1], slope = cc_pseudis.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_pseudis.mass, aes(intercept = cc_pseudis.mass[2,1], slope = cc_pseudis.mass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_pseudis.mass, aes(intercept = cc_pseudis.mass[3,1], slope = cc_pseudis.mass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Pseudis}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_pseudis.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = pseudis) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_pseudis.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_pseudis.mass)

#view fits
summary(ols_pseudis.mass)

#confidence intervals
confint(ols_pseudis.mass, conf.level=0.95)

#make plot
plot_pseudis.mass.ols <- ggplot(pseudis, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Pseudis paradoxa") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```


### _Polypedates leucomystax_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- polypedates %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Polypedates}
#SMA model
sma_polypedates.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = polypedates, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_polypedates.mass, which = "default",type = "o") 
plot(sma_polypedates.mass,which = "residual",type = "o")
plot(sma_polypedates.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_polypedates.mass)

#view pairwise comparisons
multcompmatrix(sma_polypedates.mass)

#save coefficients of fits as object
cc_polypedates.mass <- data.frame(coef(sma_polypedates.mass))

#make plot
plot_polypedates.mass <- ggplot(polypedates, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Polypedates leucomystax") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_polypedates.mass, aes(intercept = cc_polypedates.mass[1,1], slope = cc_polypedates.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_polypedates.mass, aes(intercept = cc_polypedates.mass[2,1], slope = cc_polypedates.mass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_polypedates.mass, aes(intercept = cc_polypedates.mass[3,1], slope = cc_polypedates.mass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Polypedates}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_polypedates.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = polypedates) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_polypedates.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_polypedates.mass)

#view fits
summary(ols_polypedates.mass)

#confidence intervals
confint(ols_polypedates.mass, conf.level=0.95)

#make plot
plot_polypedates.mass.ols <- ggplot(polypedates, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Polypedates leucomystax") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Hyla meridionalis_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- hyla %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Hyla}
#SMA model
sma_hyla.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = hyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_hyla.mass, which = "default",type = "o") 
plot(sma_hyla.mass,which = "residual",type = "o")
plot(sma_hyla.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_hyla.mass)

#save coefficients of fits as object
cc_hyla.mass <- data.frame(coef(sma_hyla.mass))

#since slopes are equal among groups, test for difference in elevation
sma_hyla_el.mass <- sma(formula = eyemean ~ rootmass_mass + gosner_category,
            data = hyla, 
            log = "xy", #sets both x and y variables as logged
            method ="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 
#show results
summary(sma_hyla_el.mass)

#make plot
plot_hyla.mass <- ggplot(hyla, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Hyla meridionalis: Eye diameter vs mass") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_hyla.mass, aes(intercept = cc_hyla.mass[1,1], slope = cc_hyla.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_hyla.mass, aes(intercept = cc_hyla.mass[2,1], slope = cc_hyla.mass[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_hyla.mass, aes(intercept = cc_hyla.mass[3,1], slope = cc_hyla.mass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Hyla}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_hyla.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = hyla) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_hyla.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_hyla.mass)

#view fits
summary(ols_hyla.mass)

#confidence intervals
confint(ols_hyla.mass, conf.level=0.95)

#make plot
plot_hyla.mass.ols <- ggplot(hyla, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Hyla meridionalis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Leptopelis spiritusnoctis_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- leptopelis %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts

```

#### SMA fits
```{r SMAs-mass-Leptopelis}
#SMA model
# note: 0 metamorphs so only tadpole and adult groups included in SMA
sma_leptopelis.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = leptopelis, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_leptopelis.mass, which = "default",type = "o") 
plot(sma_leptopelis.mass,which = "residual",type = "o")
plot(sma_leptopelis.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_leptopelis.mass)

#save coefficients of fits as object
cc_leptopelis.mass <- data.frame(coef(sma_leptopelis.mass))

#make plot
plot_leptopelis.mass <- ggplot(leptopelis, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Leptopelis spiritusnoctis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_leptopelis.mass, aes(intercept = cc_leptopelis.mass[1,1], slope = cc_leptopelis.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_leptopelis.mass, aes(intercept = cc_leptopelis.mass[2,1], slope = cc_leptopelis.mass[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Leptopelis}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_leptopelis.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = leptopelis) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_leptopelis.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_leptopelis.mass)

#view fits
summary(ols_leptopelis.mass)

#confidence intervals
confint(ols_leptopelis.mass, conf.level=0.95)

#make plot
plot_leptopelis.mass.ols <- ggplot(leptopelis, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Leptopelis spiritusnoctis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Microhyla rubra_
```{r}
#Sample sizes 

#remove missing data for this analysis
data <- microhyla %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Microhyla}
#SMA model
# note: only 1 metamorph so only tadpole and adult groups included in SMA

sma_microhyla.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = microhyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_microhyla.mass, which = "default",type = "o") 
plot(sma_microhyla.mass,which = "residual",type = "o")
plot(sma_microhyla.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_microhyla.mass)

#save coefficients of fits as object
cc_microhyla.mass <- data.frame(coef(sma_microhyla.mass))

#slopes are equal, so test for difference in intercepts
sma_microhyla_el.mass <- sma(formula = eyemean ~ rootmass_mass + gosner_category,
            data = microhyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#print results
summary(sma_microhyla_el.mass)

#make plot
plot_microhyla.mass <- ggplot(microhyla, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Microhyla rubra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_microhyla.mass, aes(intercept = cc_microhyla.mass[1,1], slope = cc_microhyla.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_microhyla.mass, aes(intercept = cc_microhyla.mass[2,1], slope = cc_microhyla.mass[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Microhyla}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_microhyla.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = microhyla) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_microhyla.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_microhyla.mass)

#view fits
summary(ols_microhyla.mass)

#confidence intervals
confint(ols_microhyla.mass, conf.level=0.95)


#make plot
plot_microhyla.mass.ols <- ggplot(microhyla, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Microhyla rubra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Kaloula pulchra_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- kaloula %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Kaloula}
#SMA model
sma_kaloula.mass  <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = kaloula, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_kaloula.mass, which = "default",type = "o") 
plot(sma_kaloula.mass,which = "residual",type = "o")
plot(sma_kaloula.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_kaloula.mass)

#view pairwise comparisons
multcompmatrix(sma_kaloula.mass)

#save coefficients of fits as object
cc_kaloula.mass <- data.frame(coef(sma_kaloula.mass))

#slopes are equal, so test for difference in intercepts
sma_kaloula_el.mass  <- sma(formula = eyemean ~ rootmass_mass + gosner_category,
            data = kaloula, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#view results
summary(sma_kaloula_el.mass)

#make plot
plot_kaloula.mass <- ggplot(kaloula, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Kaloula pulchra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_kaloula.mass, aes(intercept = cc_kaloula.mass[1,1], slope = cc_kaloula.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_kaloula.mass, aes(intercept = cc_kaloula.mass[2,1], slope = cc_kaloula.mass[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_kaloula.mass, aes(intercept = cc_kaloula.mass[3,1], slope = cc_kaloula.mass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-mass-Kaloula}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_kaloula.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = kaloula) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_kaloula.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_kaloula.mass)

#view fits
summary(ols_kaloula.mass)

#confidence intervals
confint(ols_kaloula.mass, conf.level=0.95)


#make plot
plot_kaloula.mass.ols <- ggplot(kaloula, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Kaloula pulchra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Hemisus marmoratus_
```{r}
#Sample sizes

#remove missing data for this analysis
data <- hemisus %>% drop_na(rootmass_mass) %>% drop_na(eyemean)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-mass-Hemisus}
#SMA model
sma_hemisus.mass <- sma(formula = eyemean ~ rootmass_mass * gosner_category,
            data = hemisus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_hemisus.mass, which = "default",type = "o") 
plot(sma_hemisus.mass,which = "residual",type = "o")
plot(sma_hemisus.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_hemisus.mass)

#view pairwise comparisons
multcompmatrix(sma_hemisus.mass)

#save coefficients of fits as object
cc_hemisus.mass <- data.frame(coef(sma_hemisus.mass))

#make plot
plot_hemisus.mass <- ggplot(hemisus, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Hemisus marmoratus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_hemisus.mass, aes(intercept = cc_hemisus.mass[1,1], slope = cc_hemisus.mass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  #geom_abline(data = cc_hemisus.mass, aes(intercept = cc_hemisus.mass[2,1], slope = cc_hemisus.mass[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_hemisus.mass, aes(intercept = cc_hemisus.mass[3,1], slope = cc_hemisus.mass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole

```

#### OLS fits
```{r OLS-mass-Hemisus}

#OLS models for eye diameter vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_hemisus.mass <- lm(formula = log10(eyemean) ~ log10(rootmass_mass) * gosner_category,
            data = hemisus) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_hemisus.mass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_hemisus.mass)

#view fits
summary(ols_hemisus.mass)

#confidence intervals
confint(ols_hemisus.mass, conf.level=0.95)

#make plot
plot_hemisus.mass.ols <- ggplot(hemisus, aes(x = rootmass_mass, y = eyemean, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Hemisus marmoratus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### Figure for eye scaling with body mass

##### Figure S2
```{r Figure-S2-SMA, fig.height = 8, fig.width = 8, results = "hide"}

# edit original plots to make them nicer panels for figure
a <- plot_rana.mass + 
  ggtitle(expression(paste(italic("Rana temporaria"),"*"))) +   
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10("Eye diameter (mm)", labels = scales::number_format(accuracy = 0.1))

f <- plot_xenopus.mass +
  ggtitle(expression(paste(italic("Xenopus victorianus")^"â€ "))) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))  #remove y axis for multipanel plot

c <- plot_bufo.mass +
  ggtitle(expression(paste(italic("Bufo bufo"),"*"))) + 
   theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))  #remove y axis for multipanel plot

d <- plot_aubria.mass +
  ggtitle(expression(paste(italic("Aubria subsigillata"),"*"))) + 
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10("Eye diameter (mm)", labels = scales::number_format(accuracy = 0.1)) 

e <- plot_pseudis.mass +
  ggtitle(expression(paste(italic("Pseudis paradoxa")^"â€ "))) + 
    theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1)) 

j <- plot_microhyla.mass +
  ggtitle(expression(paste(italic("Microhyla rubra"))^"â€ ")) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10("Eye diameter (mm)", labels = scales::number_format(accuracy = 0.1))

h <- plot_hyla.mass +
  ggtitle("Hyla meridionalis") +
  theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + # remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))

g <- plot_polypedates.mass +
  ggtitle(expression(paste(italic("Polypedates leucomystax"),"*"))) + 
    theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10("") + #new label on x axis
  scale_y_log10("Eye diameter (mm)", labels = scales::number_format(accuracy = 0.1))

b <- plot_trichobatrachus.mass +
  ggtitle(expression(paste(italic("Trichobatrachus robustus")^"â€ "))) +
   theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10("") + #new label on x axis
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1)) 

k <- plot_kaloula.mass +
  ggtitle(expression(paste(italic("Kaloula pulchra")^"â€ "))) +
  theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10("Cube root of mass (g)") + #new label on x axis
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1)) #remove y axis for multipanel plot

i <- plot_leptopelis.mass +
  ggtitle(expression(paste(italic("Leptopelis spiritusnoctis"),"*"))) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))

l <- plot_hemisus.mass +
  ggtitle(expression(paste(italic("Hemisus marmoratus"),"*"))) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))

# arrange plots in panels
plots <- plot_grid( a, b, c, d, e, f, g, h, i, j, k, l, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           axis = 'lb',
           labels = c("A", "B", "C", "D", "E", "F", "G", "H", "I","J", "K", "L"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           nrow = 4) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="bottom"))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1))

#export figure
png("../Figures/Figure-S2.png", width = 10, height = 10, units = "in", res = 500)
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1), align = 'vh')
dev.off()
```

#### Figure 2
```{r Figure-2-OLS, fig.height = 8, fig.width = 8, results = "hide"}

# edit original plots to make them nicer panels for figure
a <- plot_rana.mass.ols + 
  ggtitle(expression(paste(italic("Rana temporaria"),"*"))) +   
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10("Eye diameter (mm)", labels = scales::number_format(accuracy = 0.1))

f <- plot_xenopus.mass.ols +
  ggtitle(expression(paste(italic("Xenopus victorianus"),"*"))) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))  #remove y axis for multipanel plot

c <- plot_bufo.mass.ols +
  ggtitle(expression(paste(italic("Bufo bufo"),"*"))) + 
   theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))  #remove y axis for multipanel plot

d <- plot_aubria.mass.ols +
  ggtitle(expression(paste(italic("Aubria subsigillata"),"*"))) + 
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10("Eye diameter (mm)", labels = scales::number_format(accuracy = 0.1)) 

e <- plot_pseudis.mass.ols +
  ggtitle(expression(paste(italic("Pseudis paradoxa")^"â€ "))) + 
    theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1)) 

j <- plot_microhyla.mass.ols +
  ggtitle(expression(paste(italic("Microhyla rubra"),"*"))) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10("Eye diameter (mm)", labels = scales::number_format(accuracy = 0.1))

h <- plot_hyla.mass.ols +
  ggtitle("Hyla meridionalis") +
  theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + # remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))

g <- plot_polypedates.mass.ols +
  ggtitle(expression(paste(italic("Polypedates leucomystax"),"*"))) + 
    theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10("") + #new label on x axis
  scale_y_log10("Eye diameter (mm)", labels = scales::number_format(accuracy = 0.1))

b <- plot_trichobatrachus.mass.ols +
  ggtitle(expression(paste(italic("Trichobatrachus robustus")^"â€ "))) +
   theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10("") + #new label on x axis
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1)) 

k <- plot_kaloula.mass.ols +
  ggtitle(expression(paste(italic("Kaloula pulchra")^"â€ "))) +
  theme(plot.title = element_text(face="italic"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10("Cube root of mass (g)") + #new label on x axis
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1)) #remove y axis for multipanel plot

i <- plot_leptopelis.mass.ols +
  ggtitle(expression(paste(italic("Leptopelis spiritusnoctis"),"*"))) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  #italicizes species name in title of plot, removes grid lines from background, removes legend
  scale_x_log10(" ") + #remove x axis for multipanel plot
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))

l <- plot_hemisus.mass.ols +
  ggtitle(expression(paste(italic("Hemisus marmoratus"),"*"))) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.position = "none") +  
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10(" ", labels = scales::number_format(accuracy = 0.1))

# arrange plots in panels
plots <- plot_grid( a, b, c, d, e, f, g, h, i, j, k, l, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           axis = 'lb',
           labels = c("A", "B", "C", "D", "E", "F", "G", "H", "I","J", "K", "L"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           nrow = 4) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="bottom"))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1))

#export figure
png("../Figures/Figure-2.png", width = 10, height = 10, units = "in", res = 500)
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1), align = 'vh')
dev.off()
```

## Body length scaling with body mass

We first fit SMA and OLS regressions for SVL vs. the cube root of body mass for all 12 species (including _Rana temporaria_ with reduced group levels) and tested for slope and/or intercept differences across life stages. 

### _Rana temporaria_

```{r}
#SMA models for eye diameter vs. snout-vent length 

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)

#Sample sizes 

#remove missing data for this analysis
data <- rana %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Rana}
#fit SMA model
sma_rana.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = rana, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_rana.svlmass, which = "default",type = "o") 
plot(sma_rana.svlmass, which = "residual",type = "o")
plot(sma_rana.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_rana.svlmass)

#test for difference in intercepts
sma_rana.svlmass_el <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = rana, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05)

#view fits
summary(sma_rana.svlmass_el)

#save coefficients of fits as object
cc_rana.svlmass <- data.frame(coef(sma_rana.svlmass))

#make plot
plot_rana.svlmass <- ggplot(rana, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Rana temporaria")^"â€ "))) + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_rana.svlmass, aes(intercept = cc_rana.svlmass[1,1], slope = cc_rana.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_rana.svlmass, aes(intercept = cc_rana.svlmass[2,1], slope = cc_rana.svlmass[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_rana.svlmass, aes(intercept = cc_rana.svlmass[3,1], slope = cc_rana.svlmass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Rana}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_rana.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = rana)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_rana.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_rana.svlmass)

#view fits
summary(ols_rana.svlmass)

#confidence intervals
confint(ols_rana.svlmass, conf.level=0.95)

#make plot
plot_rana.svlmass.ols <- ggplot(rana, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Rana temporaria") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Xenopus victorianus_

```{r}
#Sample sizes

#remove missing data for this analysis
data <- xenopus %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Xenopus}
# SMA model
#note: only 1 metamorph so only included tadpoles and adults
sma_xenopus.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category, 
            data = xenopus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_xenopus.svlmass, which = "default",type = "o") 
plot(sma_xenopus.svlmass, which = "residual",type = "o")
plot(sma_xenopus.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_xenopus.svlmass)

#test for difference in intercepts
sma_xenopus.svlmass_el <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category, 
            data = xenopus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#view fits
summary(sma_xenopus.svlmass_el)

#save coefficients of fits as object
cc_xenopus.svlmass <- data.frame(coef(sma_xenopus.svlmass))

#make plot
plot_xenopus.svlmass <- ggplot(xenopus, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Xenopus victorianus")^"â€ "))) + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_xenopus.svlmass, aes(intercept = cc_xenopus.svlmass[1,1], slope = cc_xenopus.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adults
  geom_abline(data = cc_xenopus.svlmass, aes(intercept = cc_xenopus.svlmass[2,1], slope = cc_xenopus.svlmass[2,2]), linetype = "dashed", color = cols["tadpole"]) #tadpole
```

#### OLS fits
```{r OLS-size-mass-Xenopus}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_xenopus.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = xenopus)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_xenopus.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_xenopus.svlmass)

#view fits
summary(ols_xenopus.svlmass)

#confidence intervals
confint(ols_xenopus.svlmass, conf.level=0.95)


#make plot
plot_xenopus.svlmass.ols <- ggplot(xenopus, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Xenopus victorianus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Trichobatrachus robustus_

```{r}
#Sample sizes

#remove missing data for this analysis
data <- trichobatrachus %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Trichobatrachus}



# SMA model
sma_trichobatrachus.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = trichobatrachus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_trichobatrachus.svlmass, which = "default",type = "o") 
plot(sma_trichobatrachus.svlmass,which = "residual",type = "o")
plot(sma_trichobatrachus.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_trichobatrachus.svlmass)

#save coefficients of fits as object
cc_trichobatrachus.svlmass <- data.frame(coef(sma_trichobatrachus.svlmass))

#since slopes are equal, test for differences in intercepts
sma_trichobatrachus_el.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = trichobatrachus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#results
summary(sma_trichobatrachus_el.svlmass)
multcompmatrix(sma_trichobatrachus_el.svlmass)

#make plot
plot_trichobatrachus.svlmass <- ggplot(trichobatrachus, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
ggtitle(expression(paste(italic("Trichobatrachus robustus")^"â€ "))) +   theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_trichobatrachus.svlmass, aes(intercept = cc_trichobatrachus.svlmass[1,1], slope = cc_trichobatrachus.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_trichobatrachus.svlmass, aes(intercept = cc_trichobatrachus.svlmass[2,1], slope = cc_trichobatrachus.svlmass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_trichobatrachus.svlmass, aes(intercept = cc_trichobatrachus.svlmass[3,1], slope = cc_trichobatrachus.svlmass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Trichobatrachus}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_trichobatrachus.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = trichobatrachus)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_trichobatrachus.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_trichobatrachus.svlmass)

#view fits
summary(ols_trichobatrachus.svlmass)

#confidence intervals
confint(ols_trichobatrachus.svlmass, conf.level=0.95)

#make plot
plot_trichobatrachus.svlmass.ols <- ggplot(trichobatrachus, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Trichobatrachus robustus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Bufo bufo_
```{r}
#remove missing data for this analysis
data <- bufo %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Bufo}

#SMA model
sma_bufo.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = bufo, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_bufo.svlmass, which = "default",type = "o") 
plot(sma_bufo.svlmass,which = "residual",type = "o")
plot(sma_bufo.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_bufo.svlmass)

#save coefficients of fits as object
cc_bufo.svlmass <- data.frame(coef(sma_bufo.svlmass))

#test for difference in intercepts
sma_bufo.svlmass_el <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = bufo, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 
#view fits
summary(sma_bufo.svlmass_el)

#make plot
plot_bufo.svlmass <- ggplot(bufo, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Bufo bufo")))) + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_bufo.svlmass, aes(intercept = cc_bufo.svlmass[1,1], slope = cc_bufo.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_bufo.svlmass, aes(intercept = cc_bufo.svlmass[2,1], slope = cc_bufo.svlmass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_bufo.svlmass, aes(intercept = cc_bufo.svlmass[3,1], slope = cc_bufo.svlmass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Bufo}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_bufo.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = bufo)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_bufo.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_bufo.svlmass)

#view fits
summary(ols_bufo.svlmass)

#confidence intervals
confint(ols_bufo.svlmass, conf.level=0.95)


#make plot
plot_bufo.svlmass.ols <- ggplot(bufo, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Bufo bufo") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Aubria subsigillata_
```{r}
#remove missing data for this analysis
data <- aubria %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Aubria}
#SMA model
# note: only 1 metamorph so only tadpole and adult groups included in SMA
sma_aubria.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = aubria, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_aubria.svlmass, which = "default",type = "o") 
plot(sma_aubria.svlmass, which = "residual",type = "o")
plot(sma_aubria.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_aubria.svlmass)

#save coefficients of fits as object
cc_aubria.svlmass <- data.frame(coef(sma_aubria.svlmass))

#test for difference in intercepts
sma_aubria.svlmass_el <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = aubria, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#view fits
summary(sma_aubria.svlmass_el)

#make plot
plot_aubria.svlmass <- ggplot(aubria, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Aubria subsigillata")^"â€ "))) + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_aubria.svlmass, aes(intercept = cc_aubria.svlmass[1,1], slope = cc_aubria.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_aubria.svlmass, aes(intercept = cc_aubria.svlmass[2,1], slope = cc_aubria.svlmass[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Aubria}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_aubria.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = aubria)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_aubria.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_aubria.svlmass)

#view fits
summary(ols_aubria.svlmass)

#confidence intervals
confint(ols_aubria.svlmass, conf.level=0.95)

#make plot
plot_aubria.svlmass.ols <- ggplot(aubria, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Aubria subsigillata") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Pseudis paradoxa_
```{r}
#remove missing data for this analysis
data <- pseudis %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Pseudis}

#SMA model
sma_pseudis.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = pseudis, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_pseudis.svlmass, which = "default",type = "o") 
plot(sma_pseudis.svlmass,which = "residual",type = "o")
plot(sma_pseudis.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_pseudis.svlmass)

#save coefficients of fits as object
cc_pseudis.svlmass <- data.frame(coef(sma_pseudis.svlmass))

#test for difference in intercepts 
sma_pseudis.svlmass_el <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = pseudis, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 
#view fits
summary(sma_pseudis.svlmass_el)
multcompmatrix(sma_pseudis.svlmass_el)

#make plot
plot_pseudis.svlmass <- ggplot(pseudis, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Pseudis paradoxa")^"â€ "))) +   
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_pseudis.svlmass, aes(intercept = cc_pseudis.svlmass[1,1], slope = cc_pseudis.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_pseudis.svlmass, aes(intercept = cc_pseudis.svlmass[2,1], slope = cc_pseudis.svlmass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_pseudis.svlmass, aes(intercept = cc_pseudis.svlmass[3,1], slope = cc_pseudis.svlmass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Pseudis}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_pseudis.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = pseudis)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_pseudis.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_pseudis.svlmass)

#view fits
summary(ols_pseudis.svlmass)

#confidence intervals
confint(ols_pseudis.svlmass, conf.level=0.95)


#make plot
plot_pseudis.svlmass.ols <- ggplot(pseudis, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Pseudis paradoxa") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Polypedates leucomystax_
```{r}
#remove missing data for this analysis
data <- polypedates %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits 
```{r SMAs-size-mass-Polypedates}

#SMA model
sma_polypedates.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = polypedates, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_polypedates.svlmass, which = "default",type = "o") 
plot(sma_polypedates.svlmass, which = "residual",type = "o")
plot(sma_polypedates.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_polypedates.svlmass)

#save coefficients of fits as object
cc_polypedates.svlmass <- data.frame(coef(sma_polypedates.svlmass))

#test for difference in intercepts 
sma_polypedates.svlmass_el <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = polypedates, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#view fits
summary(sma_polypedates.svlmass_el)
multcompmatrix(sma_polypedates.svlmass_el)

#make plot
plot_polypedates.svlmass <- ggplot(polypedates, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Polypedates leucomystax")^"â€ "))) + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_polypedates.svlmass, aes(intercept = cc_polypedates.svlmass[1,1], slope = cc_polypedates.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_polypedates.svlmass, aes(intercept = cc_polypedates.svlmass[2,1], slope = cc_polypedates.svlmass[2,2]), linetype = "dotdash", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_polypedates.svlmass, aes(intercept = cc_polypedates.svlmass[3,1], slope = cc_polypedates.svlmass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Polypedates}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_polypedates.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = polypedates)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_polypedates.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_polypedates.svlmass)

#view fits
summary(ols_polypedates.svlmass)

#confidence intervals
confint(ols_polypedates.svlmass, conf.level=0.95)

#make plot
plot_polypedates.svlmass.ols <- ggplot(polypedates, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Polypedates leucomystax") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Hyla meridionalis_
```{r}
#remove missing data for this analysis
data <- hyla %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Hyla}

#SMA model
sma_hyla.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = hyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_hyla.svlmass, which = "default",type = "o") 
plot(sma_hyla.svlmass,which = "residual",type = "o")
plot(sma_hyla.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_hyla.svlmass)

#save coefficients of fits as object
cc_hyla.svlmass <- data.frame(coef(sma_hyla.svlmass))

#since slopes are equal among groups, test for difference in elevation
sma_hyla_el.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = hyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#show results
summary(sma_hyla_el.svlmass)
multcompmatrix(sma_hyla_el.svlmass)

#make plot
plot_hyla.svlmass <- ggplot(hyla, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Hyla merdionalis")^"â€ "))) + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_hyla.svlmass, aes(intercept = cc_hyla.svlmass[1,1], slope = cc_hyla.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_hyla.svlmass, aes(intercept = cc_hyla.svlmass[3,1], slope = cc_hyla.svlmass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Hyla}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_hyla.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = hyla)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_hyla.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_hyla.svlmass)

#view fits
summary(ols_hyla.svlmass)

#confidence intervals
confint(ols_hyla.svlmass, conf.level=0.95)

#make plot
plot_hyla.svlmass.ols <- ggplot(hyla, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Hyla meridionalis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Leptopelis spiritisnoctis_
```{r}
#remove missing data for this analysis
data <- leptopelis %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Leptopelis}

#SMA models
# note: 0 metamorphs so only tadpole and adult groups included in SMA
sma_leptopelis.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = leptopelis, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_leptopelis.svlmass, which = "default",type = "o") 
plot(sma_leptopelis.svlmass, which = "residual",type = "o")
plot(sma_leptopelis.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_leptopelis.svlmass)

#save coefficients of fits as object
cc_leptopelis.svlmass <- data.frame(coef(sma_leptopelis.svlmass))

#make plot
plot_leptopelis.svlmass <- ggplot(leptopelis, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Leptopelis spiritusnoctis"),"*"))) +   
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_leptopelis.svlmass, aes(intercept = cc_leptopelis.svlmass[1,1], slope = cc_leptopelis.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_leptopelis.svlmass, aes(intercept = cc_leptopelis.svlmass[2,1], slope = cc_leptopelis.svlmass[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Leptopelis}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_leptopelis.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = leptopelis)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_leptopelis.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_leptopelis.svlmass)

#view fits
summary(ols_leptopelis.svlmass)

#confidence intervals
confint(ols_leptopelis.svlmass, conf.level=0.95)

#make plot
plot_leptopelis.svlmass.ols <- ggplot(leptopelis, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Leptopelis spiritisnoctis") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Microhyla rubra_
```{r}
#remove missing data for this analysis
data <- microhyla %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Microhyla}

#SMA model
# note: only 1 metamorph so only tadpole and adult groups included in SMA
sma_microhyla.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass* gosner_category,
            data = microhyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_microhyla.svlmass, which = "default",type = "o") 
plot(sma_microhyla.svlmass, which = "residual",type = "o")
plot(sma_microhyla.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_microhyla.svlmass)

#save coefficients of fits as object
cc_microhyla.svlmass <- data.frame(coef(sma_microhyla.svlmass))

#test for difference in intercepts
sma_microhyla.svlmass_el <- sma(formula = Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = microhyla, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#view results
summary(sma_microhyla.svlmass_el)

#make plot
plot_microhyla.svlmass <- ggplot(microhyla, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Microhyla rubra")))) + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_microhyla.svlmass, aes(intercept = cc_microhyla.svlmass[1,1], slope = cc_microhyla.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_microhyla.svlmass, aes(intercept = cc_microhyla.svlmass[2,1], slope = cc_microhyla.svlmass[2,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Microhyla}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_microhyla.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = microhyla)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_microhyla.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_microhyla.svlmass)

#view fits
summary(ols_microhyla.svlmass)

#confidence intervals
confint(ols_microhyla.svlmass, conf.level=0.95)

#make plot
plot_microhyla.svlmass.ols <- ggplot(microhyla, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Microhyla rubra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Kaloula pulchra_
```{r}
#remove missing data for this analysis
data <- kaloula %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Kaloula}
# SMA model
sma_kaloula.svlmass  <- sma(formula =  Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = kaloula, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_kaloula.svlmass, which = "default",type = "o") 
plot(sma_kaloula.svlmass, which = "residual",type = "o")
plot(sma_kaloula.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_kaloula.svlmass)

#save coefficients of fits as object
cc_kaloula.svlmass <- data.frame(coef(sma_kaloula.svlmass))

#test for difference in intercepts
sma_kaloula.svlmass_el  <- sma(formula =  Snout.Vent_length ~ rootmass_mass + gosner_category,
            data = kaloula, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#view results
summary(sma_kaloula.svlmass_el)

#make plot
plot_kaloula.svlmass <- ggplot(kaloula, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Kaloula pulchra"),"*"))) +  
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_kaloula.svlmass, aes(intercept = cc_kaloula.svlmass[1,1], slope = cc_kaloula.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_kaloula.svlmass, aes(intercept = cc_kaloula.svlmass[2,1], slope = cc_kaloula.svlmass[2,2]), linetype = "solid", color = cols["metamorph"]) + #metamorph
  geom_abline(data = cc_kaloula.svlmass, aes(intercept = cc_kaloula.svlmass[3,1], slope = cc_kaloula.svlmass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole
```

#### OLS fits
```{r OLS-size-mass-Kaloula}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_kaloula.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = kaloula)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_kaloula.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_kaloula.svlmass)

#view fits
summary(ols_kaloula.svlmass)

#confidence intervals
confint(ols_kaloula.svlmass, conf.level=0.95)

#make plot
plot_kaloula.svlmass.ols <- ggplot(kaloula, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Kaloula pulchra") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### _Hemisus marmoratus_
```{r}
#remove missing data for this analysis
data <- hemisus %>% drop_na(rootmass_mass) %>% drop_na(Snout.Vent_length)

#compile counts by life stage
counts <-ddply(data, .(data$gosner_category), nrow) 

#rename columns
names(counts) <- c("Life stage","Sampled")

#print sample sizes
counts
```

#### SMA fits
```{r SMAs-size-mass-Hemisus}

#SMA model
sma_hemisus.svlmass <- sma(formula = Snout.Vent_length ~ rootmass_mass * gosner_category,
            data = hemisus, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_hemisus.svlmass, which = "default",type = "o") 
plot(sma_hemisus.svlmass,which = "residual",type = "o")
plot(sma_hemisus.svlmass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_hemisus.svlmass)

#view pairwise comparisons
multcompmatrix(sma_hemisus.svlmass)

#save coefficients of fits as object
cc_hemisus.svlmass <- data.frame(coef(sma_hemisus.svlmass))

#make plot
plot_hemisus.svlmass <- ggplot(hemisus, aes(y = Snout.Vent_length, x = rootmass_mass, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_y_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_x_log10(name = "Cube root of mass (g)") + #makes y axis log scale and named
  ggtitle(expression(paste(italic("Hemisus marmoratus"),"*"))) + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_abline(data = cc_hemisus.svlmass, aes(intercept = cc_hemisus.svlmass[1,1], slope = cc_hemisus.svlmass[1,2]), linetype = "solid", color = cols["adult"]) + #adult
  geom_abline(data = cc_hemisus.svlmass, aes(intercept = cc_hemisus.svlmass[3,1], slope = cc_hemisus.svlmass[3,2]), linetype = "dashed", color = cols["tadpole"])  #tadpole

```

#### OLS fits
```{r OLS-size-mass-Hemisus}

#OLS models for SVL vs. cube root of mass

#make color palette
cols <- c("adult" = "#009E73",
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#make shape palette
shapes <- c("adult" = 21, 
            "metamorph" = 22,
            "tadpole" = 23)
#ols model
ols_hemisus.svlmass <- lm(formula = log10(Snout.Vent_length) ~ log10(rootmass_mass) * gosner_category,
            data = hemisus)

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(ols_hemisus.svlmass)
par(mfrow = c(1,1)) 

#overall significance of effects
anova(ols_hemisus.svlmass)

#view fits
summary(ols_hemisus.svlmass)

#confidence intervals
confint(ols_hemisus.svlmass, conf.level=0.95)

#make plot
plot_hemisus.svlmass.ols <- ggplot(hemisus, aes(x = rootmass_mass, y = Snout.Vent_length, color = gosner_category, shape = gosner_category, fill = gosner_category)) + 
  geom_point(size = 2, alpha = 0.6) + 
  scale_color_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_fill_manual(values = cols, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) +
  scale_shape_manual(values = shapes, name = "Life Stage", 
                     breaks = c("adult", "metamorph", "tadpole")) + 
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "SVL (mm)") + #makes y axis log scale and named
  ggtitle("Hemisus marmoratus") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  geom_smooth(method = "lm", alpha = 0.4)
```

### Figure for SVL scaling with body mass

#### Figure S6
```{r Figure-S6-SMA, fig.height = 8, fig.width = 8, results = "hide"}

# edit original plots to make them nicer panels for figure
a <- plot_rana.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10(" ")  

f <- plot_xenopus.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") +
  scale_y_log10(" ")

c <- plot_bufo.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ")

d <- plot_aubria.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10("SVL (mm)") 

e <- plot_pseudis.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ")

j <- plot_microhyla.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10("SVL (mm)") 

h <- plot_hyla.svlmass +
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ") 

g <- plot_polypedates.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10("SVL (mm)") 

b <- plot_trichobatrachus.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ") 

k <- plot_kaloula.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10(" ")

i <- plot_leptopelis.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ")

l <- plot_hemisus.svlmass + 
  theme(legend.position = "none") +  
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10(" ")

# arrange plots in panels
plots <- plot_grid( a, b, c, d, e, f, g, h, i, j, k, l, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           axis = 'lb',
           labels = c("A", "B", "C", "D", "E", "F", "G", "H", "I","J", "K", "L"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           nrow = 4) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="bottom"))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1))

#export figure
png("../Figures/Figure-S6.png", width = 10, height = 10, units = "in", res = 500)
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1), align = 'vh')
dev.off()
```

#### Figure S5
```{r Figure-S5-OLS, fig.height = 8, fig.width = 8, results = "hide"}

# edit original plots to make them nicer panels for figure
a <- plot_rana.svlmass.ols + 
  ggtitle(expression(paste(italic("Rana temporaria")^"â€ "))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ")  

f <- plot_xenopus.svlmass.ols + 
  ggtitle(expression(paste(italic("Xenopus victorianus")," "))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") +
  scale_y_log10(" ")

c <- plot_bufo.svlmass.ols + 
  ggtitle(expression(paste(italic("Bufo bufo")," "))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ")

d <- plot_aubria.svlmass.ols + 
  ggtitle(expression(paste(italic("Aubria subsigillata")^"â€ "))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10("SVL (mm)") 

e <- plot_pseudis.svlmass.ols + 
  ggtitle(expression(paste(italic("Pseudis paradoxa")," "))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ")

j <- plot_microhyla.svlmass.ols + 
  ggtitle(expression(paste(italic("Microhyla rubra")^"â€ "))) + 
  theme(legend.position = "none") +  
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10("SVL (mm)") 

h <- plot_hyla.svlmass.ols +
  ggtitle(expression(paste(italic("Hyla meridionalis")^"â€ "))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ") 

g <- plot_polypedates.svlmass.ols + 
  ggtitle(expression(paste(italic("Polypedates leucomystax")^"â€ "))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10("SVL (mm)") 

b <- plot_trichobatrachus.svlmass.ols + 
  ggtitle(expression(paste(italic("Trichobatrachus robustus")^"â€ "))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ") 

k <- plot_kaloula.svlmass.ols + 
  ggtitle(expression(paste(italic("Kaloula pulchra"),"*"))) + 
  theme(legend.position = "none") +  
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10(" ")

i <- plot_leptopelis.svlmass.ols + 
  ggtitle(expression(paste(italic("Leptopelis spiritusnoctis"),"*"))) + 
  theme(legend.position = "none") +  
  scale_x_log10(" ") + 
  scale_y_log10(" ")

l <- plot_hemisus.svlmass.ols + 
  ggtitle(expression(paste(italic("Hemisus marmoratus"),"*"))) + 
  theme(legend.position = "none") +  
  scale_x_log10("Cube root of mass (g)") + 
  scale_y_log10(" ")

# arrange plots in panels
plots <- plot_grid( a, b, c, d, e, f, g, h, i, j, k, l, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           axis = 'lb',
           labels = c("A", "B", "C", "D", "E", "F", "G", "H", "I","J", "K", "L"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           nrow = 4) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="bottom"))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1))

#export figure
png("../Figures/Figure-S5.png", width = 10, height = 10, units = "in", res = 500)
plot_grid(plots, leg, ncol = 1, rel_heights = c(1, .1), align = 'vh')
dev.off()
```


# Differences in tadpole or adult allometry across species

## Linear mixed models

Here, we used linear mixed models in the lme4 package to test whether tadpoles of different species (or adults of different species, in a separate set of models) show differences in their allometric eye-body scaling slopes. We fit our eye vs. body size data with species as a random effect to 1) a constant-slope, variable-intercepts model and 2) a variable-slopes and intercepts model, and then compared model fits by AIC scores. 

## Eye-SVL

### Tadpoles

```{r tads-lme4}
# data subset
tadpoles.svl <- frogs %>% 
  filter(gosner_category == "tadpole") %>%
  mutate(species_ID = as.character(genus_species)) %>% 
  drop_na(Snout.Vent_length) %>% 
  drop_na(eyemean)

# variable intercepts model (species can have different intercepts) -------
lme_tad1 <- lmer(log10(eyemean) ~ log10(Snout.Vent_length) + (1|genus_species),
data = tadpoles.svl)

# summary
summary(lme_tad1)

# intercepts (variable) and slope (constant)
coef(lme_tad1)

# AIC
AIC(lme_tad1)

# variable slopes model (species can have different slopes/interaction effect between body size and species on eye size) -------
lme_tad2 <- lmer(log10(eyemean) ~ log10(Snout.Vent_length) + (1 + log10(Snout.Vent_length) | genus_species), data = tadpoles.svl)

# summary
summary(lme_tad2)

# intercepts (variable) and slope (constant)
coef(lme_tad2)

# AIC
AIC(lme_tad2)

```

### Adults

```{r adults-lme4}
# mean-center numeric variables and scale to variance (eye size and SVL) 
adults.svl <- frogs %>% 
  filter(gosner_category == "adult") %>%
  mutate(species_ID = as.character(genus_species)) %>% 
  drop_na(Snout.Vent_length) %>% 
  drop_na(eyemean)

# variable intercepts model (species can have different intercepts) -------
lme_ad1 <- lmer(log10(eyemean) ~ log10(Snout.Vent_length) + (1|genus_species),
data = adults.svl)

# summary
summary(lme_ad1)

# intercepts (variable) and slope (constant)
coef(lme_ad1)

# AIC
AIC(lme_ad1)

# variable slopes model (species can have different slopes/interaction effect between body size and species on eye size) -------
lme_ad2 <- lmer(log10(eyemean) ~ log10(Snout.Vent_length) + (1 + log10(Snout.Vent_length) | genus_species), data = adults.svl)

# summary
summary(lme_ad2)

# intercepts (variable) and slope (constant)
coef(lme_ad2)

# AIC
AIC(lme_ad2)
```

## Eye-mass

### Tadpoles

```{r tads-lme4-mass}
# data subset
tadpoles.mass <- frogs %>% 
  filter(gosner_category == "tadpole") %>%
  mutate(species_ID = as.character(genus_species)) %>% 
  drop_na(rootmass_mass) %>% 
  drop_na(eyemean)

# variable intercepts model (species can have different intercepts) -------
lme_tad1.mass <- lmer(log10(eyemean) ~ log10(rootmass_mass) + (1|genus_species),
data = tadpoles.mass)

# summary
summary(lme_tad1.mass)

# intercepts (variable) and slope (constant)
coef(lme_tad1.mass)

# AIC
AIC(lme_tad1.mass)

# variable slopes model (species can have different slopes/interaction effect between body size and species on eye size) -------
lme_tad2.mass <- lmer(log10(eyemean) ~ log10(rootmass_mass) + (1 + log10(rootmass_mass) | genus_species), data = tadpoles.mass)

# summary
summary(lme_tad2.mass)

# intercepts (variable) and slope (constant)
coef(lme_tad2.mass)

# AIC
AIC(lme_tad2.mass)

```

### Adults

```{r adults-lme4-mass}
# mean-center numeric variables and scale to variance (eye size and SVL) 
adults.mass <- frogs %>% 
  filter(gosner_category == "adult") %>%
  mutate(species_ID = as.character(genus_species)) %>% 
  drop_na(rootmass_mass) %>% 
  drop_na(eyemean)

# variable intercepts model (species can have different intercepts) -------
lme_ad1.mass <- lmer(log10(eyemean) ~ log10(rootmass_mass) + (1|genus_species),
data = adults.mass)

# summary
summary(lme_ad1.mass)

# intercepts (variable) and slope (constant)
coef(lme_ad1.mass)

# AIC
AIC(lme_ad1.mass)

# variable slopes model (species can have different slopes/interaction effect between body size and species on eye size) -------
lme_ad2.mass <- lmer(log10(eyemean) ~ log10(rootmass_mass) + (1 + log10(rootmass_mass) | genus_species), data = adults.mass)

# summary
summary(lme_ad2.mass)

# intercepts (variable) and slope (constant)
coef(lme_ad2.mass)

# AIC
AIC(lme_ad2.mass)
```

## Comparison of allometry across species with SMA pairwise comparisons

We also examined pairwise comparisons of eye-body allometry among species in a model of eye size vs. body size x species, run separately among adults and among tadpoles. 

### Tadpole eye scaling across species

```{r tadpole-comparison}

#subset out tadpoles
tadpoles <- frogs %>% 
  filter(gosner_category == "tadpole") %>%
  mutate(species_text = as.factor(paste(Genus, Species, sep = " ")))

#set limits by species for plots
tad.limits.svl <- tadpoles %>%
  group_by(genus_species) %>%
  summarise(max = max(Snout.Vent_length, na.rm = TRUE),
            min = min(Snout.Vent_length, na.rm = TRUE))

#set limits by species for plots
tad.limits.mass <- tadpoles %>%
  group_by(genus_species) %>%
  summarise(max = max(rootmass_mass, na.rm = TRUE),
            min = min(rootmass_mass, na.rm = TRUE))


# tadpole eye scaling with SVL ---------

#use SMA to compare tadpole eye scaling slopes with SVL across species
sma_tadpole.svl <- sma(formula = eyemean ~ Snout.Vent_length * genus_species, 
            data = tadpoles, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_tadpole.svl, which = "default",type = "o") 
plot(sma_tadpole.svl,which = "residual",type = "o")
plot(sma_tadpole.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_tadpole.svl)

#save coefficients of fits as object
cc_tadpole.svl <- data.frame(coef(sma_tadpole.svl))

#make shape pallette
shapes.sp <- c("Aubria subsigillata" = 21,
              "Bufo bufo" = 22, 
              "Hemisus marmoratus" = 23, 
              "Hyla meridionalis" = 24,
              "Kaloula pulchra" = 25 , 
              "Leptopelis spiritusnoctis" = 21, 
              "Microhyla rubra" = 22, 
              "Polypedates leucomystax" = 23, 
              "Pseudis paradoxa" = 24, 
              "Rana temporaria" = 25, 
              "Trichobatrachus robustus" = 21 ,
              "Xenopus victorianus" = 22)

#make color pallette
cols.sp <- c("Aubria subsigillata" = "#a6cee3",
              "Bufo bufo" = "#1f78b4", 
              "Hemisus marmoratus" = "#b2df8a", 
              "Hyla meridionalis" = "#33a02c",
              "Kaloula pulchra" = "#fb9a99" , 
              "Leptopelis spiritusnoctis" = "#e31a1c", 
              "Microhyla rubra" = "#fdbf6f", 
              "Polypedates leucomystax" = "#ff7f00", 
              "Pseudis paradoxa" = "#cab2d6", 
              "Rana temporaria" = "#6a3d9a", 
              "Trichobatrachus robustus" ="gray31" ,
              "Xenopus victorianus" = "black")

#make plot
plot_tadpole.svl <- ggplot(tadpoles, aes(x = Snout.Vent_length, y = eyemean, color = species_text, shape = species_text, fill = species_text)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_shape_manual(values = shapes.sp, name = "Species") + 
  scale_color_manual(values = cols.sp, name = "Species") +
  scale_fill_manual(values = cols.sp, name = "Species") +
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Tadpole eye scaling") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.text = element_text(face = "italic")) +
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Rana_temporaria")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Rana_temporaria")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Rana_temporaria")])*cc_tadpole.svl["Rana_temporaria", "slope"] + cc_tadpole.svl["Rana_temporaria", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Rana_temporaria")])*cc_tadpole.svl["Rana_temporaria", "slope"] + cc_tadpole.svl["Rana_temporaria", "elevation"])), color = cols.sp["Rana temporaria"]) + #Rana temporaria tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Aubria_subsigillata")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Aubria_subsigillata")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Aubria_subsigillata")])*cc_tadpole.svl["Aubria_subsigillata", "slope"] + cc_tadpole.svl["Aubria_subsigillata", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Aubria_subsigillata")])*cc_tadpole.svl["Aubria_subsigillata", "slope"] + cc_tadpole.svl["Aubria_subsigillata", "elevation"])), color = cols.sp["Aubria subsigillata"]) + #Aubria_subsigillata tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Kaloula_pulchra")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Kaloula_pulchra")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Kaloula_pulchra")])*cc_tadpole.svl["Kaloula_pulchra", "slope"] + cc_tadpole.svl["Kaloula_pulchra", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Kaloula_pulchra")])*cc_tadpole.svl["Kaloula_pulchra", "slope"] + cc_tadpole.svl["Kaloula_pulchra", "elevation"])), color = cols.sp["Kaloula pulchra"]) + #Kaloula_pulchra tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Pseudis_paradoxa")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Pseudis_paradoxa")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Pseudis_paradoxa")])*cc_tadpole.svl["Pseudis_paradoxa", "slope"] + cc_tadpole.svl["Pseudis_paradoxa", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Pseudis_paradoxa")])*cc_tadpole.svl["Pseudis_paradoxa", "slope"] + cc_tadpole.svl["Pseudis_paradoxa", "elevation"])), color = cols.sp["Pseudis paradoxa"]) + #Pseudis_paradoxa tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Bufo_bufo")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Bufo_bufo")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Bufo_bufo")])*cc_tadpole.svl["Bufo_bufo", "slope"] + cc_tadpole.svl["Bufo_bufo", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Bufo_bufo")])*cc_tadpole.svl["Bufo_bufo", "slope"] + cc_tadpole.svl["Bufo_bufo", "elevation"])), color = cols.sp["Bufo bufo"]) + #Bufo_bufo tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Leptopelis_spiritusnoctis")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Leptopelis_spiritusnoctis")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Leptopelis_spiritusnoctis")])*cc_tadpole.svl["Leptopelis_spiritusnoctis", "slope"] + cc_tadpole.svl["Leptopelis_spiritusnoctis", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Leptopelis_spiritusnoctis")])*cc_tadpole.svl["Leptopelis_spiritusnoctis", "slope"] + cc_tadpole.svl["Leptopelis_spiritusnoctis", "elevation"])), color = cols.sp["Leptopelis spiritusnoctis"]) + #Leptopelis spiritusnoctis tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Hemisus_marmoratus")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Hemisus_marmoratus")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Hemisus_marmoratus")])*cc_tadpole.svl["Hemisus_marmoratus", "slope"] + cc_tadpole.svl["Hemisus_marmoratus", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Hemisus_marmoratus")])*cc_tadpole.svl["Hemisus_marmoratus", "slope"] + cc_tadpole.svl["Hemisus_marmoratus", "elevation"])), color = cols.sp["Hemisus marmoratus"]) + #Hemisus marmoratus tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Microhyla_rubra")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Microhyla_rubra")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Microhyla_rubra")])*cc_tadpole.svl["Microhyla_rubra", "slope"] + cc_tadpole.svl["Microhyla_rubra", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Microhyla_rubra")])*cc_tadpole.svl["Microhyla_rubra", "slope"] + cc_tadpole.svl["Microhyla_rubra", "elevation"])), color = cols.sp["Microhyla rubra"]) + #Microhyla rubra tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Trichobatrachus_robustus")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Trichobatrachus_robustus")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Trichobatrachus_robustus")])*cc_tadpole.svl["Trichobatrachus_robustus", "slope"] + cc_tadpole.svl["Trichobatrachus_robustus", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Trichobatrachus_robustus")])*cc_tadpole.svl["Trichobatrachus_robustus", "slope"] + cc_tadpole.svl["Trichobatrachus_robustus", "elevation"])), color = cols.sp["Trichobatrachus robustus"]) + #Trichobatrachus robustus tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Hyla_meridionalis")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Hyla_meridionalis")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Hyla_meridionalis")])*cc_tadpole.svl["Hyla_meridionalis", "slope"] + cc_tadpole.svl["Hyla_meridionalis", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Hyla_meridionalis")])*cc_tadpole.svl["Hyla_meridionalis", "slope"] + cc_tadpole.svl["Hyla_meridionalis", "elevation"])), color = cols.sp["Hyla meridionalis"]) + #Hyla meriondalis tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Polypedates_leucomystax")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Polypedates_leucomystax")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Polypedates_leucomystax")])*cc_tadpole.svl["Polypedates_leucomystax", "slope"] + cc_tadpole.svl["Polypedates_leucomystax", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Polypedates_leucomystax")])*cc_tadpole.svl["Polypedates_leucomystax", "slope"] + cc_tadpole.svl["Polypedates_leucomystax", "elevation"])), color = cols.sp["Polypedates leucomystax"]) + #Polypedates leucomystax tadpole scaling
  geom_segment(aes(x = tad.limits.svl$min[which(tad.limits.svl$genus_species == "Xenopus_victorianus")], xend = tad.limits.svl$max[which(tad.limits.svl$genus_species == "Xenopus_victorianus")], y = 10^(log10(tad.limits.svl$min[which(tad.limits.svl$genus_species == "Xenopus_victorianus")])*cc_tadpole.svl["Xenopus_victorianus", "slope"] + cc_tadpole.svl["Xenopus_victorianus", "elevation"]), yend = 10^(log10(tad.limits.svl$max[which(tad.limits.svl$genus_species == "Xenopus_victorianus")])*cc_tadpole.svl["Xenopus_victorianus", "slope"] + cc_tadpole.svl["Xenopus_victorianus", "elevation"])), color = cols.sp["Xenopus victorianus"])  #Xenopus victorianus tadpole scaling

#interactive plot
ggplotly(plot_tadpole.svl)


# tadpole eye scaling with mass ---------

#use SMA to compare tadpole eye scaling slopes with SVL across species
sma_tadpole.mass <- sma(formula = eyemean ~ rootmass_mass * genus_species, 
            data = tadpoles, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_tadpole.mass, which = "default",type = "o") 
plot(sma_tadpole.mass,which = "residual",type = "o")
plot(sma_tadpole.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_tadpole.mass)

#save coefficients of fits as object
cc_tadpole.mass <- data.frame(coef(sma_tadpole.mass))

#make plot
plot_tadpole.mass <- ggplot(tadpoles, aes(x = rootmass_mass, y = eyemean, color = species_text, shape = species_text, fill = species_text)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_shape_manual(values = shapes.sp, name = "Species") + 
  scale_color_manual(values = cols.sp, name = "Species") +
  scale_fill_manual(values = cols.sp, name = "Species") +
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Tadpole eye scaling") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.text = element_text(face = "italic")) +
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Rana_temporaria")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Rana_temporaria")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Rana_temporaria")])*cc_tadpole.mass["Rana_temporaria", "slope"] + cc_tadpole.mass["Rana_temporaria", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Rana_temporaria")])*cc_tadpole.mass["Rana_temporaria", "slope"] + cc_tadpole.mass["Rana_temporaria", "elevation"])), color = cols.sp["Rana temporaria"]) + #Rana temporaria tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Aubria_subsigillata")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Aubria_subsigillata")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Aubria_subsigillata")])*cc_tadpole.mass["Aubria_subsigillata", "slope"] + cc_tadpole.mass["Aubria_subsigillata", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Aubria_subsigillata")])*cc_tadpole.mass["Aubria_subsigillata", "slope"] + cc_tadpole.mass["Aubria_subsigillata", "elevation"])), color = cols.sp["Aubria subsigillata"]) + #Aubria_subsigillata tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Kaloula_pulchra")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Kaloula_pulchra")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Kaloula_pulchra")])*cc_tadpole.mass["Kaloula_pulchra", "slope"] + cc_tadpole.mass["Kaloula_pulchra", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Kaloula_pulchra")])*cc_tadpole.mass["Kaloula_pulchra", "slope"] + cc_tadpole.mass["Kaloula_pulchra", "elevation"])), color = cols.sp["Kaloula pulchra"]) + #Kaloula_pulchra tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Pseudis_paradoxa")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Pseudis_paradoxa")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Pseudis_paradoxa")])*cc_tadpole.mass["Pseudis_paradoxa", "slope"] + cc_tadpole.mass["Pseudis_paradoxa", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Pseudis_paradoxa")])*cc_tadpole.mass["Pseudis_paradoxa", "slope"] + cc_tadpole.mass["Pseudis_paradoxa", "elevation"])), color = cols.sp["Pseudis paradoxa"]) + #Pseudis_paradoxa tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Bufo_bufo")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Bufo_bufo")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Bufo_bufo")])*cc_tadpole.mass["Bufo_bufo", "slope"] + cc_tadpole.mass["Bufo_bufo", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Bufo_bufo")])*cc_tadpole.mass["Bufo_bufo", "slope"] + cc_tadpole.mass["Bufo_bufo", "elevation"])), color = cols.sp["Bufo bufo"]) + #Bufo_bufo tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Leptopelis_spiritusnoctis")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Leptopelis_spiritusnoctis")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Leptopelis_spiritusnoctis")])*cc_tadpole.mass["Leptopelis_spiritusnoctis", "slope"] + cc_tadpole.mass["Leptopelis_spiritusnoctis", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Leptopelis_spiritusnoctis")])*cc_tadpole.mass["Leptopelis_spiritusnoctis", "slope"] + cc_tadpole.mass["Leptopelis_spiritusnoctis", "elevation"])), color = cols.sp["Leptopelis spiritusnoctis"]) + #Leptopelis spiritusnoctis tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Hemisus_marmoratus")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Hemisus_marmoratus")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Hemisus_marmoratus")])*cc_tadpole.mass["Hemisus_marmoratus", "slope"] + cc_tadpole.mass["Hemisus_marmoratus", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Hemisus_marmoratus")])*cc_tadpole.mass["Hemisus_marmoratus", "slope"] + cc_tadpole.mass["Hemisus_marmoratus", "elevation"])), color = cols.sp["Hemisus marmoratus"]) + #Hemisus marmoratus tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Microhyla_rubra")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Microhyla_rubra")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Microhyla_rubra")])*cc_tadpole.mass["Microhyla_rubra", "slope"] + cc_tadpole.mass["Microhyla_rubra", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Microhyla_rubra")])*cc_tadpole.mass["Microhyla_rubra", "slope"] + cc_tadpole.mass["Microhyla_rubra", "elevation"])), color = cols.sp["Microhyla rubra"]) + #Microhyla rubra tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Trichobatrachus_robustus")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Trichobatrachus_robustus")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Trichobatrachus_robustus")])*cc_tadpole.mass["Trichobatrachus_robustus", "slope"] + cc_tadpole.mass["Trichobatrachus_robustus", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Trichobatrachus_robustus")])*cc_tadpole.mass["Trichobatrachus_robustus", "slope"] + cc_tadpole.mass["Trichobatrachus_robustus", "elevation"])), color = cols.sp["Trichobatrachus robustus"]) + #Trichobatrachus robustus tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Hyla_meridionalis")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Hyla_meridionalis")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Hyla_meridionalis")])*cc_tadpole.mass["Hyla_meridionalis", "slope"] + cc_tadpole.mass["Hyla_meridionalis", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Hyla_meridionalis")])*cc_tadpole.mass["Hyla_meridionalis", "slope"] + cc_tadpole.mass["Hyla_meridionalis", "elevation"])), color = cols.sp["Hyla meridionalis"]) + #Hyla meriondalis tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Polypedates_leucomystax")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Polypedates_leucomystax")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Polypedates_leucomystax")])*cc_tadpole.mass["Polypedates_leucomystax", "slope"] + cc_tadpole.mass["Polypedates_leucomystax", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Polypedates_leucomystax")])*cc_tadpole.mass["Polypedates_leucomystax", "slope"] + cc_tadpole.mass["Polypedates_leucomystax", "elevation"])), color = cols.sp["Polypedates leucomystax"]) + #Polypedates leucomystax tadpole scaling
  geom_segment(aes(x = tad.limits.mass$min[which(tad.limits.mass$genus_species == "Xenopus_victorianus")], xend = tad.limits.mass$max[which(tad.limits.mass$genus_species == "Xenopus_victorianus")], y = 10^(log10(tad.limits.mass$min[which(tad.limits.mass$genus_species == "Xenopus_victorianus")])*cc_tadpole.mass["Xenopus_victorianus", "slope"] + cc_tadpole.mass["Xenopus_victorianus", "elevation"]), yend = 10^(log10(tad.limits.mass$max[which(tad.limits.mass$genus_species == "Xenopus_victorianus")])*cc_tadpole.mass["Xenopus_victorianus", "slope"] + cc_tadpole.mass["Xenopus_victorianus", "elevation"])), color = cols.sp["Xenopus victorianus"])  #Xenopus victorianus tadpole scaling


#interactive plot
ggplotly(plot_tadpole.mass)
```

### Adult eye scaling across species

```{r adult-comparison}

#subset out adults
adults <- frogs %>% 
  filter(gosner_category == "adult") %>%
  mutate(species_text = as.factor(paste(Genus, Species, sep = " ")))

#set limits by species for plots
ad.limits.svl <- adults %>%
  group_by(genus_species) %>%
  summarise(max = max(Snout.Vent_length, na.rm = TRUE),
            min = min(Snout.Vent_length, na.rm = TRUE))

#set limits by species for plots
ad.limits.mass <- adults %>%
  group_by(genus_species) %>%
  summarise(max = max(rootmass_mass, na.rm = TRUE),
            min = min(rootmass_mass, na.rm = TRUE))


# adult eye scaling with SVL ---------

#use SMA to compare adult eye scaling slopes with SVL across species
sma_adult.svl <- sma(formula = eyemean ~ Snout.Vent_length * genus_species, 
            data = adults, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_adult.svl, which = "default",type = "o") 
plot(sma_adult.svl,which = "residual",type = "o")
plot(sma_adult.svl, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_adult.svl)

#save coefficients of fits as object
cc_adult.svl <- data.frame(coef(sma_adult.svl))

#make shape pallette
shapes.sp <- c("Aubria subsigillata" = 21,
              "Bufo bufo" = 22, 
              "Hemisus marmoratus" = 23, 
              "Hyla meridionalis" = 24,
              "Kaloula pulchra" = 25 , 
              "Leptopelis spiritusnoctis" = 21, 
              "Microhyla rubra" = 22, 
              "Polypedates leucomystax" = 23, 
              "Pseudis paradoxa" = 24, 
              "Rana temporaria" = 25, 
              "Trichobatrachus robustus" = 21 ,
              "Xenopus victorianus" = 22)

#make color pallette
cols.sp <- c("Aubria subsigillata" = "#a6cee3",
              "Bufo bufo" = "#1f78b4", 
              "Hemisus marmoratus" = "#b2df8a", 
              "Hyla meridionalis" = "#33a02c",
              "Kaloula pulchra" = "#fb9a99" , 
              "Leptopelis spiritusnoctis" = "#e31a1c", 
              "Microhyla rubra" = "#fdbf6f", 
              "Polypedates leucomystax" = "#ff7f00", 
              "Pseudis paradoxa" = "#cab2d6", 
              "Rana temporaria" = "#6a3d9a", 
              "Trichobatrachus robustus" ="gray31" ,
              "Xenopus victorianus" = "black")

#make plot
plot_adult.svl <- ggplot(adults, aes(x = Snout.Vent_length, y = eyemean, color = species_text, shape = species_text, fill = species_text)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_shape_manual(values = shapes.sp, name = "Species") + 
  scale_color_manual(values = cols.sp, name = "Species") +
  scale_fill_manual(values = cols.sp, name = "Species") +
  scale_x_log10(name = "SVL (mm)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("Adult eye scaling") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.text = element_text(face = "italic")) +
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Rana_temporaria")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Rana_temporaria")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Rana_temporaria")])*cc_adult.svl["Rana_temporaria", "slope"] + cc_adult.svl["Rana_temporaria", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Rana_temporaria")])*cc_adult.svl["Rana_temporaria", "slope"] + cc_adult.svl["Rana_temporaria", "elevation"])), color = cols.sp["Rana temporaria"]) + #Rana temporaria adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Aubria_subsigillata")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Aubria_subsigillata")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Aubria_subsigillata")])*cc_adult.svl["Aubria_subsigillata", "slope"] + cc_adult.svl["Aubria_subsigillata", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Aubria_subsigillata")])*cc_adult.svl["Aubria_subsigillata", "slope"] + cc_adult.svl["Aubria_subsigillata", "elevation"])), color = cols.sp["Aubria subsigillata"]) + #Aubria_subsigillata adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Kaloula_pulchra")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Kaloula_pulchra")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Kaloula_pulchra")])*cc_adult.svl["Kaloula_pulchra", "slope"] + cc_adult.svl["Kaloula_pulchra", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Kaloula_pulchra")])*cc_adult.svl["Kaloula_pulchra", "slope"] + cc_adult.svl["Kaloula_pulchra", "elevation"])), color = cols.sp["Kaloula pulchra"]) + #Kaloula_pulchra adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Pseudis_paradoxa")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Pseudis_paradoxa")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Pseudis_paradoxa")])*cc_adult.svl["Pseudis_paradoxa", "slope"] + cc_adult.svl["Pseudis_paradoxa", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Pseudis_paradoxa")])*cc_adult.svl["Pseudis_paradoxa", "slope"] + cc_adult.svl["Pseudis_paradoxa", "elevation"])), color = cols.sp["Pseudis paradoxa"]) + #Pseudis_paradoxa adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Bufo_bufo")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Bufo_bufo")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Bufo_bufo")])*cc_adult.svl["Bufo_bufo", "slope"] + cc_adult.svl["Bufo_bufo", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Bufo_bufo")])*cc_adult.svl["Bufo_bufo", "slope"] + cc_adult.svl["Bufo_bufo", "elevation"])), color = cols.sp["Bufo bufo"]) + #Bufo_bufo adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Leptopelis_spiritusnoctis")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Leptopelis_spiritusnoctis")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Leptopelis_spiritusnoctis")])*cc_adult.svl["Leptopelis_spiritusnoctis", "slope"] + cc_adult.svl["Leptopelis_spiritusnoctis", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Leptopelis_spiritusnoctis")])*cc_adult.svl["Leptopelis_spiritusnoctis", "slope"] + cc_adult.svl["Leptopelis_spiritusnoctis", "elevation"])), color = cols.sp["Leptopelis spiritusnoctis"]) + #Leptopelis spiritusnoctis adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Hemisus_marmoratus")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Hemisus_marmoratus")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Hemisus_marmoratus")])*cc_adult.svl["Hemisus_marmoratus", "slope"] + cc_adult.svl["Hemisus_marmoratus", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Hemisus_marmoratus")])*cc_adult.svl["Hemisus_marmoratus", "slope"] + cc_adult.svl["Hemisus_marmoratus", "elevation"])), color = cols.sp["Hemisus marmoratus"]) + #Hemisus marmoratus adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Microhyla_rubra")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Microhyla_rubra")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Microhyla_rubra")])*cc_adult.svl["Microhyla_rubra", "slope"] + cc_adult.svl["Microhyla_rubra", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Microhyla_rubra")])*cc_adult.svl["Microhyla_rubra", "slope"] + cc_adult.svl["Microhyla_rubra", "elevation"])), color = cols.sp["Microhyla rubra"]) + #Microhyla rubra adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Trichobatrachus_robustus")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Trichobatrachus_robustus")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Trichobatrachus_robustus")])*cc_adult.svl["Trichobatrachus_robustus", "slope"] + cc_adult.svl["Trichobatrachus_robustus", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Trichobatrachus_robustus")])*cc_adult.svl["Trichobatrachus_robustus", "slope"] + cc_adult.svl["Trichobatrachus_robustus", "elevation"])), color = cols.sp["Trichobatrachus robustus"]) + #Trichobatrachus robustus adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Hyla_meridionalis")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Hyla_meridionalis")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Hyla_meridionalis")])*cc_adult.svl["Hyla_meridionalis", "slope"] + cc_adult.svl["Hyla_meridionalis", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Hyla_meridionalis")])*cc_adult.svl["Hyla_meridionalis", "slope"] + cc_adult.svl["Hyla_meridionalis", "elevation"])), color = cols.sp["Hyla meridiondalis"]) + #Hyla meriondalis adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Polypedates_leucomystax")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Polypedates_leucomystax")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Polypedates_leucomystax")])*cc_adult.svl["Polypedates_leucomystax", "slope"] + cc_adult.svl["Polypedates_leucomystax", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Polypedates_leucomystax")])*cc_adult.svl["Polypedates_leucomystax", "slope"] + cc_adult.svl["Polypedates_leucomystax", "elevation"])), color = cols.sp["Polypedates leucomystax"]) + #Polypedates leucomystax adult scaling
  geom_segment(aes(x = ad.limits.svl$min[which(ad.limits.svl$genus_species == "Xenopus_victorianus")], xend = ad.limits.svl$max[which(ad.limits.svl$genus_species == "Xenopus_victorianus")], y = 10^(log10(ad.limits.svl$min[which(ad.limits.svl$genus_species == "Xenopus_victorianus")])*cc_adult.svl["Xenopus_victorianus", "slope"] + cc_adult.svl["Xenopus_victorianus", "elevation"]), yend = 10^(log10(ad.limits.svl$max[which(ad.limits.svl$genus_species == "Xenopus_victorianus")])*cc_adult.svl["Xenopus_victorianus", "slope"] + cc_adult.svl["Xenopus_victorianus", "elevation"])), color = cols.sp["Xenopus victorianus"])  
#interactive plot
ggplotly(plot_adult.svl)


# adult eye scaling with mass ---------

#use SMA to compare adult eye scaling slopes with SVL across species
sma_adult.mass <- sma(formula = eyemean ~ rootmass_mass * genus_species, 
            data = adults, 
            log = "xy", #sets both x and y variables as logged
            method="SMA", #defines SMA as model
            multcomp = TRUE, # adds pairwise comparisons between groups
            multcompmethod = "adjusted", # adjusts p-value for multiple comparisons
            alpha = 0.05) 

#plot fit, residuals, qq
par(mfrow = c(2,2)) #make plot window 2x2
plot(sma_adult.mass, which = "default",type = "o") 
plot(sma_adult.mass,which = "residual",type = "o")
plot(sma_adult.mass, which = "qq", type = "o")
par(mfrow = c(1,1)) 

#view fits
summary(sma_adult.mass)

#save coefficients of fits as object
cc_adult.mass <- data.frame(coef(sma_adult.mass))

#make plot
plot_adult.mass <- ggplot(adults, aes(x = rootmass_mass, y = eyemean, color = species_text, shape = species_text, fill = species_text)) + 
  geom_point(size = 2.5, alpha = 0.7) + 
  scale_shape_manual(values = shapes.sp, name = "Species") + 
  scale_color_manual(values = cols.sp, name = "Species") +
  scale_fill_manual(values = cols.sp, name = "Species") +
  scale_x_log10(name = "Cube root of mass (g)") + #makes x axis log scale and named
  scale_y_log10(name = "Eye diameter (mm)") + #makes y axis log scale and named
  ggtitle("adult eye scaling") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend.text = element_text(face = "italic")) +
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Rana_temporaria")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Rana_temporaria")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Rana_temporaria")])*cc_adult.mass["Rana_temporaria", "slope"] + cc_adult.mass["Rana_temporaria", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Rana_temporaria")])*cc_adult.mass["Rana_temporaria", "slope"] + cc_adult.mass["Rana_temporaria", "elevation"])), color = cols.sp["Rana temporaria"]) + #Rana temporaria adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Aubria_subsigillata")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Aubria_subsigillata")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Aubria_subsigillata")])*cc_adult.mass["Aubria_subsigillata", "slope"] + cc_adult.mass["Aubria_subsigillata", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Aubria_subsigillata")])*cc_adult.mass["Aubria_subsigillata", "slope"] + cc_adult.mass["Aubria_subsigillata", "elevation"])), color = cols.sp["Aubria subsigillata"]) + #Aubria_subsigillata adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Kaloula_pulchra")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Kaloula_pulchra")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Kaloula_pulchra")])*cc_adult.mass["Kaloula_pulchra", "slope"] + cc_adult.mass["Kaloula_pulchra", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Kaloula_pulchra")])*cc_adult.mass["Kaloula_pulchra", "slope"] + cc_adult.mass["Kaloula_pulchra", "elevation"])), color = cols.sp["Kaloula pulchra"]) + #Kaloula_pulchra adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Pseudis_paradoxa")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Pseudis_paradoxa")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Pseudis_paradoxa")])*cc_adult.mass["Pseudis_paradoxa", "slope"] + cc_adult.mass["Pseudis_paradoxa", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Pseudis_paradoxa")])*cc_adult.mass["Pseudis_paradoxa", "slope"] + cc_adult.mass["Pseudis_paradoxa", "elevation"])), color = cols.sp["Pseudis paradoxa"]) + #Pseudis_paradoxa adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Bufo_bufo")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Bufo_bufo")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Bufo_bufo")])*cc_adult.mass["Bufo_bufo", "slope"] + cc_adult.mass["Bufo_bufo", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Bufo_bufo")])*cc_adult.mass["Bufo_bufo", "slope"] + cc_adult.mass["Bufo_bufo", "elevation"])), color = cols.sp["Bufo bufo"]) + #Bufo_bufo adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Leptopelis_spiritusnoctis")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Leptopelis_spiritusnoctis")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Leptopelis_spiritusnoctis")])*cc_adult.mass["Leptopelis_spiritusnoctis", "slope"] + cc_adult.mass["Leptopelis_spiritusnoctis", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Leptopelis_spiritusnoctis")])*cc_adult.mass["Leptopelis_spiritusnoctis", "slope"] + cc_adult.mass["Leptopelis_spiritusnoctis", "elevation"])), color = cols.sp["Leptopelis spiritusnoctis"]) + #Leptopelis spiritusnoctis adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Hemisus_marmoratus")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Hemisus_marmoratus")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Hemisus_marmoratus")])*cc_adult.mass["Hemisus_marmoratus", "slope"] + cc_adult.mass["Hemisus_marmoratus", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Hemisus_marmoratus")])*cc_adult.mass["Hemisus_marmoratus", "slope"] + cc_adult.mass["Hemisus_marmoratus", "elevation"])), color = cols.sp["Hemisus marmoratus"]) + #Hemisus marmoratus adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Microhyla_rubra")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Microhyla_rubra")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Microhyla_rubra")])*cc_adult.mass["Microhyla_rubra", "slope"] + cc_adult.mass["Microhyla_rubra", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Microhyla_rubra")])*cc_adult.mass["Microhyla_rubra", "slope"] + cc_adult.mass["Microhyla_rubra", "elevation"])), color = cols.sp["Microhyla rubra"]) + #Microhyla rubra adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Trichobatrachus_robustus")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Trichobatrachus_robustus")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Trichobatrachus_robustus")])*cc_adult.mass["Trichobatrachus_robustus", "slope"] + cc_adult.mass["Trichobatrachus_robustus", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Trichobatrachus_robustus")])*cc_adult.mass["Trichobatrachus_robustus", "slope"] + cc_adult.mass["Trichobatrachus_robustus", "elevation"])), color = cols.sp["Trichobatrachus robustus"]) + #Trichobatrachus robustus adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Hyla_meridionalis")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Hyla_meridionalis")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Hyla_meridionalis")])*cc_adult.mass["Hyla_meridionalis", "slope"] + cc_adult.mass["Hyla_meridionalis", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Hyla_meridionalis")])*cc_adult.mass["Hyla_meridionalis", "slope"] + cc_adult.mass["Hyla_meridionalis", "elevation"])), color = cols.sp["Hyla meridiondalis"]) + #Hyla meriondalis adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Polypedates_leucomystax")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Polypedates_leucomystax")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Polypedates_leucomystax")])*cc_adult.mass["Polypedates_leucomystax", "slope"] + cc_adult.mass["Polypedates_leucomystax", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Polypedates_leucomystax")])*cc_adult.mass["Polypedates_leucomystax", "slope"] + cc_adult.mass["Polypedates_leucomystax", "elevation"])), color = cols.sp["Polypedates leucomystax"]) + #Polypedates leucomystax adult scaling
  geom_segment(aes(x = ad.limits.mass$min[which(ad.limits.mass$genus_species == "Xenopus_victorianus")], xend = ad.limits.mass$max[which(ad.limits.mass$genus_species == "Xenopus_victorianus")], y = 10^(log10(ad.limits.mass$min[which(ad.limits.mass$genus_species == "Xenopus_victorianus")])*cc_adult.mass["Xenopus_victorianus", "slope"] + cc_adult.mass["Xenopus_victorianus", "elevation"]), yend = 10^(log10(ad.limits.mass$max[which(ad.limits.mass$genus_species == "Xenopus_victorianus")])*cc_adult.mass["Xenopus_victorianus", "slope"] + cc_adult.mass["Xenopus_victorianus", "elevation"])), color = cols.sp["Xenopus victorianus"])  #Xenopus victorianus adult scaling

#interactive plot
ggplotly(plot_adult.mass)
```

### Figure comparing tadpoles and adults across species

#### Figure 3

```{r Figure-3, fig.height=10, fig.width=15, results = "hide"}

# edit original plots to make them nicer panels for figure
a <- plot_tadpole.mass +
  ggtitle("Tadpoles") +
  theme(legend.position = "none", plot.title = element_text(size=16), axis.text=element_text(size=14), axis.title=element_text(size=16))

b <- plot_adult.mass +
  ggtitle("Adults") +
  theme(legend.position = "none", plot.title = element_text(size=16), axis.text=element_text(size=14), axis.title=element_text(size=16))

c <- plot_tadpole.svl +
  ggtitle("Tadpoles") +
  theme(legend.position = "none", plot.title = element_text(size=16), axis.text=element_text(size=14), axis.title=element_text(size=16))

d <- plot_adult.svl +
  ggtitle("Adults") +
  theme(legend.position = "none", plot.title = element_text(size=16), axis.text=element_text(size=14), axis.title=element_text(size=16))

# arrange plots in panels
plots <- plot_grid( a, b, c, d,  #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           labels = c("A", "B", "C", "D"), #panel labels for figure
           hjust = -1, #adjustment for panel labels
           nrow = 2) #number of rows in grids

# extract legend from Rana temporaria figure
leg <- get_legend(a + theme(legend.position="right", legend.text=element_text(size=14), legend.title = element_text(size=14)))

# construct full figure with panels and legend
plot_grid(plots, leg, ncol = 2, rel_widths = c(1, .25), align = 'vh')

#export figure
png("../Figures/Figure-3.png", width = 15, height = 10, units = "in", res = 500)
plot_grid(plots, leg, ncol = 2, rel_widths = c(1, .25), align = 'vh')
dev.off()
```


# Testing for ecological effects on allometry in tadpoles and in adults

Here, we use a phylogenetic linear mixed model approach (implemented in the MCMCglmm package) to test whether eye-body allometry differs significantly across ecological factors. In these models, our response variable is eye diameter, our fixed effects are body size and an ecological variable, and our random effects are species identity and the phylogenetic non-independence among species. We fit models separately for tadpoles and adults. We used the default priors (mu = 0 and V = 1^10) for fixed effects, and set priors of V = 1 and nu = 0.02 for random effects (a fairly uninformative/unbiased prior). Note that this is a Bayesian model, so the output will be slightly different each time it is run. 

```{r mcmcglmm-setup}

# Prep phylogeny ------

#Remove zero length branches and replace with polytomies
tree.pruned2 <- di2multi(tree.pruned)

# Remove node labels 
tree.pruned2$node.label <- NULL

# Get the inverse vcv matrix for the phylogeny
inv.phylo <- inverseA(tree.pruned2, nodes = "TIPS", scale = TRUE)$Ainv

# Prep data subsets ------

#add genus_species column to traits dataframe
traits <- traits %>%
  mutate(genus_species = as.factor(paste(Genus, Species, sep = "_"))) %>%
  select(genus_species, adult_habitat, adult_activity, tad_microhab, tad_eyes, tad_mouth) %>%
  mutate(adult_hab_bin = recode_factor(adult_habitat, "aquatic" = "aquatic-fossorial", "fossorial" = "aquatic-fossorial", "ground" = "terrestrial", "scansorial" = "terrestrial", "semiaquatic" = "terrestrial", "subfossorial" = "aquatic-fossorial"))

# tadpole SVL and traits
tads.svl.traits <- left_join(tadpoles.svl, traits, by = "genus_species") %>%
  mutate(Species_ID = genus_species)

# adult SVL and traits
ads.svl.traits <- left_join(adults.svl, traits, by = "genus_species") %>%
  mutate(Species_ID = genus_species)

# tadpole mass and traits
tads.mass.traits <- left_join(tadpoles.mass, traits, by = "genus_species") %>%
  mutate(Species_ID = genus_species)

# adult mass and traits
ads.mass.traits <- left_join(adults.mass, traits, by = "genus_species") %>%
  mutate(Species_ID = genus_species)

# Set up model parameters------

#Set up MCMCglmm priors
# Inverse Wishart with V = 1 and nu = 0.02
# i.e. fairly uninformative priors
prior <- list(G = list(G1 = list(V = 1, nu = 0.02), 
                        G2 = list(V = 1,nu = 0.02)), 
               R = list(V = 1, nu = 0.02))

# Inverse Wishart with V = 1 and nu = 1
# i.e. very different prior for testing effect on parameter estimates
prior_alt <- list(G = list(G1 = list(V = 1, nu = 1), 
                        G2 = list(V = 1,nu = 1)), 
               R = list(V = 1, nu = 1))

# Set number of iterations
nitt <- 1000000

# Set burnin
burnin <- 1000

# Sampling interval
thin <- 200
```

## Tadpole microhabitat

### Eye size vs. svl x tadpole microhabitat

#### Tadpoles
```{r microhab-tad-svl, cache = TRUE, fig.height=10}

# eye mean vs. SVL * tadpole microhabitat with species identity and phylogeny as random effects.
tadpole.micro_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_microhab),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.micro_mcmcglmm$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.micro_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.micro_mcmcglmm$Sol[, 1:tadpole.micro_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.micro_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(tadpole.micro_mcmcglmm)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.micro_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.micro_mcmcglmm$VCV)

# Get DIC of model
tadpole.micro_mcmcglmm$DIC

# Get lambda
lambda.tad.micro <- tadpole.micro_mcmcglmm$VCV[,'Species_ID']/
          (tadpole.micro_mcmcglmm$VCV[,'Species_ID'] + tadpole.micro_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.tad.micro)

# Posterior mode of lambda
posterior.mode(lambda.tad.micro)

# HPD interval
HPDinterval(lambda.tad.micro)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.tad.micro), aes(x = lambda.tad.micro))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.tad.micro), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.micro)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.micro)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.micro_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_microhab),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.micro_mcmcglmm_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.micro_mcmcglmm_alt$VCV)
HPDinterval(tadpole.micro_mcmcglmm_alt$VCV)
```

#### Adults
```{r microhab-ad-svl, cache = TRUE, fig.height=10}
# eye mean vs. SVL * tadpole microhabitat with species identity and phylogeny as random effects.
adult.micro_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_microhab),
                   data = ads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.micro_mcmcglmm$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.micro_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.micro_mcmcglmm$Sol[, 1:adult.micro_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.micro_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(adult.micro_mcmcglmm)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.micro_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.micro_mcmcglmm$VCV)

# Get DIC of model
adult.micro_mcmcglmm$DIC

# Get lambda
lambda.ad.micro <- adult.micro_mcmcglmm$VCV[,'Species_ID']/
          (adult.micro_mcmcglmm$VCV[,'Species_ID'] + adult.micro_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.micro)

# Posterior mode of lambda
posterior.mode(lambda.ad.micro)

# HPD interval
HPDinterval(lambda.ad.micro)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.micro), aes(x = lambda.ad.micro))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.micro), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.micro)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.micro)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.micro_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_microhab),
                   data = ads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.micro_mcmcglmm_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.micro_mcmcglmm_alt$VCV)
HPDinterval(adult.micro_mcmcglmm_alt$VCV)
```

### Eye size vs. mass x tadpole microhabitat

#### Tadpoles
```{r microhab-tad-mass, cache = TRUE, fig.height=10}

# eye mean vs. cube root mass * tadpole microhabitat with species identity and phylogeny as random effects.
tadpole.micro_mcmcglmm.mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_microhab),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.micro_mcmcglmm.mass$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.micro_mcmcglmm.mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.micro_mcmcglmm.mass$Sol[, 1:tadpole.micro_mcmcglmm.mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.micro_mcmcglmm.mass$VCV)

# Look at summary of fixed effect results
summary(tadpole.micro_mcmcglmm.mass)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.micro_mcmcglmm.mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.micro_mcmcglmm.mass$VCV)

# Get DIC of model
tadpole.micro_mcmcglmm.mass$DIC

# Get lambda
lambda.tad.micro.mass <- tadpole.micro_mcmcglmm.mass$VCV[,'Species_ID']/
          (tadpole.micro_mcmcglmm.mass$VCV[,'Species_ID'] + tadpole.micro_mcmcglmm.mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.tad.micro)

# Posterior mode of lambda
posterior.mode(lambda.tad.micro.mass)

# HPD interval
HPDinterval(lambda.tad.micro.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.tad.micro.mass), aes(x = lambda.tad.micro.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.tad.micro.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.micro.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.micro.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.micro_mcmcglmm.mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_microhab),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.micro_mcmcglmm.mass_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.micro_mcmcglmm.mass_alt$VCV)
HPDinterval(tadpole.micro_mcmcglmm.mass_alt$VCV)
```

#### Adults
```{r microhab-ad-mass, cache = TRUE, fig.height=10}

# eye mean vs.cube root mass * tadpole microhabitat with species identity and phylogeny as random effects.
adult.micro_mcmcglmm.mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_microhab),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.micro_mcmcglmm.mass$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.micro_mcmcglmm.mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.micro_mcmcglmm.mass$Sol[, 1:adult.micro_mcmcglmm.mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.micro_mcmcglmm.mass$VCV)

# Look at summary of fixed effect results
summary(adult.micro_mcmcglmm.mass)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.micro_mcmcglmm.mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.micro_mcmcglmm.mass$VCV)

# Get DIC of model
adult.micro_mcmcglmm.mass$DIC

# Get lambda
lambda.ad.micro.mass <- adult.micro_mcmcglmm.mass$VCV[,'Species_ID']/
          (adult.micro_mcmcglmm.mass$VCV[,'Species_ID'] + adult.micro_mcmcglmm.mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.micro.mass)

# Posterior mode of lambda
posterior.mode(lambda.ad.micro.mass)

# HPD interval
HPDinterval(lambda.ad.micro.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.micro.mass), aes(x = lambda.ad.micro.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.micro.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.micro.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.micro.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.micro_mcmcglmm.mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_microhab),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.micro_mcmcglmm.mass_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.micro_mcmcglmm.mass_alt$VCV)
HPDinterval(adult.micro_mcmcglmm.mass_alt$VCV)
```

## Adult binary habitat

### Eye size vs. svl x binary adult habitat

#### Tadpoles
```{r tadhab-tad-svl, cache = TRUE, fig.height=10}

# eye mean vs. SVL * adult habitat with species identity and phylogeny as random effects.
tadpole.hab_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(adult_hab_bin),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.hab_mcmcglmm$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.hab_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.hab_mcmcglmm$Sol[, 1:tadpole.hab_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.hab_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(tadpole.hab_mcmcglmm)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.hab_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.hab_mcmcglmm$VCV)

# Get DIC of model
tadpole.hab_mcmcglmm$DIC

# Get lambda
lambda.tad.hab <- tadpole.hab_mcmcglmm$VCV[,'Species_ID']/
          (tadpole.hab_mcmcglmm$VCV[,'Species_ID'] + tadpole.hab_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.tad.hab)

# Posterior mode of lambda
posterior.mode(lambda.tad.hab)

# HPD interval
HPDinterval(lambda.tad.hab)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.tad.hab), aes(x = lambda.tad.hab))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.tad.hab), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.hab)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.hab)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.hab_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(adult_hab_bin),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.hab_mcmcglmm_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.hab_mcmcglmm_alt$VCV)
HPDinterval(tadpole.hab_mcmcglmm_alt$VCV)
```

#### Adults
```{r adhab-ad-svl, cache = TRUE, fig.height=10}
# eye mean vs. SVL * adult habitat with species identity and phylogeny as random effects.
adult.hab_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_hab_bin),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.hab_mcmcglmm$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.hab_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.hab_mcmcglmm$Sol[, 1:adult.hab_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.hab_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(adult.hab_mcmcglmm)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.hab_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.hab_mcmcglmm$VCV)

# Get DIC of model
adult.hab_mcmcglmm$DIC

# Get lambda
lambda.ad.hab <- adult.hab_mcmcglmm$VCV[,'Species_ID']/
          (adult.hab_mcmcglmm$VCV[,'Species_ID'] + adult.hab_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.hab)

# Posterior mode of lambda
posterior.mode(lambda.ad.hab)

# HPD interval
HPDinterval(lambda.ad.hab)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.hab), aes(x = lambda.ad.hab))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.hab), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.hab)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.hab)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.hab_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_hab_bin),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.hab_mcmcglmm_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.hab_mcmcglmm_alt$VCV)
HPDinterval(adult.hab_mcmcglmm_alt$VCV)
```

### Eye size vs. mass x binary adult habitat

#### Tadpoles
```{r tadhab-tad-mass, cache = TRUE, fig.height=10}

# eye mean vs. cube root mass * adult habitat with species identity and phylogeny as random effects.
tadpole.hab_mcmcglmm_mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_hab_bin),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.hab_mcmcglmm_mass$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.hab_mcmcglmm_mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.hab_mcmcglmm_mass$Sol[, 1:tadpole.hab_mcmcglmm_mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.hab_mcmcglmm_mass$VCV)

# Look at summary of fixed effect results
summary(tadpole.hab_mcmcglmm_mass)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.hab_mcmcglmm_mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.hab_mcmcglmm_mass$VCV)

# Get DIC of model
tadpole.hab_mcmcglmm_mass$DIC

# Get lambda
lambda.tad.hab.mass <- tadpole.hab_mcmcglmm_mass$VCV[,'Species_ID']/
          (tadpole.hab_mcmcglmm_mass$VCV[,'Species_ID'] + tadpole.hab_mcmcglmm_mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.tad.hab.mass)

# Posterior mode of lambda
posterior.mode(lambda.tad.hab.mass)

# HPD interval
HPDinterval(lambda.tad.hab.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.tad.hab.mass), aes(x = lambda.tad.hab.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.tad.hab.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.hab.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.hab.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.hab_mcmcglmm_mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_hab_bin),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.hab_mcmcglmm_mass_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.hab_mcmcglmm_mass_alt$VCV)
HPDinterval(tadpole.hab_mcmcglmm_mass_alt$VCV)
```

#### Adults
```{r adhab-ad-mass, cache = TRUE, fig.height=10}

# eye mean vs. cube root mass * adult microhabitat with species identity and phylogeny as random effects.
adult.hab_mcmcglmm_mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_hab_bin),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.hab_mcmcglmm_mass$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.hab_mcmcglmm_mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.hab_mcmcglmm_mass$Sol[, 1:adult.hab_mcmcglmm_mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.hab_mcmcglmm_mass$VCV)

# Look at summary of fixed effect results
summary(adult.hab_mcmcglmm_mass)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.hab_mcmcglmm_mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.hab_mcmcglmm_mass$VCV)

# Get DIC of model
adult.hab_mcmcglmm_mass$DIC

# Get lambda
lambda.ad.hab.mass <- adult.hab_mcmcglmm_mass$VCV[,'Species_ID']/
          (adult.hab_mcmcglmm_mass$VCV[,'Species_ID'] + adult.hab_mcmcglmm_mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.hab.mass)

# Posterior mode of lambda
posterior.mode(lambda.ad.hab.mass)

# HPD interval
HPDinterval(lambda.ad.hab.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.hab.mass), aes(x = lambda.ad.hab.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.hab.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.hab.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.hab.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.hab_mcmcglmm_mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_hab_bin),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.hab_mcmcglmm_mass_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.hab_mcmcglmm_mass_alt$VCV)
HPDinterval(adult.hab_mcmcglmm_mass_alt$VCV)
```

## Adult activity pattern

### Eye size vs. svl x adult activity pattern

#### Tadpoles
```{r adact-tad-svl, cache = TRUE, fig.height=10}

# eye mean vs. SVL * adult activity with species identity and phylogeny as random effects.
tadpole.act_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(adult_activity),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.act_mcmcglmm$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.act_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.act_mcmcglmm$Sol[, 1:tadpole.act_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.act_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(tadpole.act_mcmcglmm)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.act_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.act_mcmcglmm$VCV)

# Get DIC of model
tadpole.act_mcmcglmm$DIC

# Get lambda
lambda.act.hab <- tadpole.act_mcmcglmm$VCV[,'Species_ID']/
          (tadpole.act_mcmcglmm$VCV[,'Species_ID'] + tadpole.act_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.act.hab)

# Posterior mode of lambda
posterior.mode(lambda.act.hab)

# HPD interval
HPDinterval(lambda.act.hab)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.act.hab), aes(x = lambda.act.hab))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.act.hab), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.act.hab)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.act.hab)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.act_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(adult_activity),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.act_mcmcglmm_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.act_mcmcglmm_alt$VCV)
HPDinterval(tadpole.act_mcmcglmm_alt$VCV)
```

#### Adults
```{r adact-ad-svl, cache = TRUE, fig.height=10}
# eye mean vs. SVL * adult activity with species identity and phylogeny as random effects.
adult.act_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_activity),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.act_mcmcglmm$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.act_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.act_mcmcglmm$Sol[, 1:adult.act_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.act_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(adult.act_mcmcglmm)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.act_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.act_mcmcglmm$VCV)

# Get DIC of model
adult.act_mcmcglmm$DIC

# Get lambda
lambda.ad.act <- adult.act_mcmcglmm$VCV[,'Species_ID']/
          (adult.act_mcmcglmm$VCV[,'Species_ID'] + adult.act_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.act)

# Posterior mode of lambda
posterior.mode(lambda.ad.act)

# HPD interval
HPDinterval(lambda.ad.act)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.act), aes(x = lambda.ad.act))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.act), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.act)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.act)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.act_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_activity),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.act_mcmcglmm_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.act_mcmcglmm_alt$VCV)
HPDinterval(adult.act_mcmcglmm_alt$VCV)
```

### Eye size vs. mass x adult activity pattern

#### Tadpoles
```{r tadact-tad-mass, cache = TRUE, fig.height=10}

# eye mean vs. cube root mass * adult activity with species identity and phylogeny as random effects.
tadpole.act_mcmcglmm_mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_activity),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.act_mcmcglmm_mass$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.act_mcmcglmm_mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.act_mcmcglmm_mass$Sol[, 1:tadpole.act_mcmcglmm_mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.act_mcmcglmm_mass$VCV)

# Look at summary of fixed effect results
summary(tadpole.act_mcmcglmm_mass)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.act_mcmcglmm_mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.act_mcmcglmm_mass$VCV)

# Get DIC of model
tadpole.act_mcmcglmm_mass$DIC

# Get lambda
lambda.tad.act.mass <- tadpole.act_mcmcglmm_mass$VCV[,'Species_ID']/
          (tadpole.act_mcmcglmm_mass$VCV[,'Species_ID'] + tadpole.act_mcmcglmm_mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.tad.act.mass)

# Posterior mode of lambda
posterior.mode(lambda.tad.act.mass)

# HPD interval
HPDinterval(lambda.tad.act.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.tad.act.mass), aes(x = lambda.tad.act.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.tad.act.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.act.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.act.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.act_mcmcglmm_mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_activity),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.act_mcmcglmm_mass_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.act_mcmcglmm_mass_alt$VCV)
HPDinterval(tadpole.act_mcmcglmm_mass_alt$VCV)
```

#### Adults
```{r adhab-act-mass, cache = TRUE, fig.height=10}

# eye mean vs. cube root mass * adult activity per with species identity and phylogeny as random effects.
adult.act_mcmcglmm_mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_activity),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.act_mcmcglmm_mass$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.act_mcmcglmm_mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.act_mcmcglmm_mass$Sol[, 1:adult.act_mcmcglmm_mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.act_mcmcglmm_mass$VCV)

# Look at summary of fixed effect results
summary(adult.act_mcmcglmm_mass)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.act_mcmcglmm_mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.act_mcmcglmm_mass$VCV)

# Get DIC of model
adult.act_mcmcglmm_mass$DIC

# Get lambda
lambda.ad.act.mass <- adult.act_mcmcglmm_mass$VCV[,'Species_ID']/
          (adult.act_mcmcglmm_mass$VCV[,'Species_ID'] + adult.act_mcmcglmm_mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.act.mass)

# Posterior mode of lambda
posterior.mode(lambda.ad.act.mass)

# HPD interval
HPDinterval(lambda.ad.act.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.act.mass), aes(x = lambda.ad.act.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.act.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.act.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.act.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.act_mcmcglmm_mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(adult_activity),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.act_mcmcglmm_mass_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.act_mcmcglmm_mass_alt$VCV)
HPDinterval(adult.act_mcmcglmm_mass_alt$VCV)
```

## Tadpole eye position

### Eye size vs. svl x tadpole eye position

#### Tadpoles
```{r tadeye-tad-svl, cache = TRUE, fig.height=10}

# eye mean vs. SVL * tadpole eye position with species identity and phylogeny as random effects.
tadpole.eye_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_eyes),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.eye_mcmcglmm$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.eye_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.eye_mcmcglmm$Sol[, 1:tadpole.eye_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.eye_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(tadpole.eye_mcmcglmm)$solutions

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.eye_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.eye_mcmcglmm$VCV)

# Get DIC of model
tadpole.eye_mcmcglmm$DIC

# Get lambda
lambda.eye.hab <- tadpole.eye_mcmcglmm$VCV[,'Species_ID']/
          (tadpole.eye_mcmcglmm$VCV[,'Species_ID'] + tadpole.eye_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.eye.hab)

# Posterior mode of lambda
posterior.mode(lambda.eye.hab)

# HPD interval
HPDinterval(lambda.eye.hab)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.eye.hab), aes(x = lambda.eye.hab))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.eye.hab), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.eye.hab)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.eye.hab)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.eye_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_eyes),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.eye_mcmcglmm_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.eye_mcmcglmm_alt$VCV)
HPDinterval(tadpole.eye_mcmcglmm_alt$VCV)
```

#### Adults
```{r tadeye-ad-svl, cache = TRUE, fig.height=10}
# eye mean vs. SVL * tadpole eye position with species identity and phylogeny as random effects.
adult.eye_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_eyes),
                   data = ads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.eye_mcmcglmm$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.eye_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.eye_mcmcglmm$Sol[, 1:adult.eye_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.eye_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(adult.eye_mcmcglmm)

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.eye_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.eye_mcmcglmm$VCV)

# Get DIC of model
adult.eye_mcmcglmm$DIC

# Get lambda
lambda.ad.eye <- adult.eye_mcmcglmm$VCV[,'Species_ID']/
          (adult.eye_mcmcglmm$VCV[,'Species_ID'] + adult.eye_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.eye)

# Posterior mode of lambda
posterior.mode(lambda.ad.eye)

# HPD interval
HPDinterval(lambda.ad.eye)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.eye), aes(x = lambda.ad.eye))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.eye), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.eye)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.eye)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.eye_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_eyes),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.eye_mcmcglmm_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.eye_mcmcglmm_alt$VCV)
HPDinterval(adult.eye_mcmcglmm_alt$VCV)
```

### Eye size vs. mass x tadpole eye position

#### Tadpoles
```{r tadeye-tad-mass, cache = TRUE, fig.height=10}

# eye mean vs. cuberoot mass * tadpole eye position with species identity and phylogeny as random effects.
tadpole.eye_mcmcglmm_mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_eyes),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.eye_mcmcglmm_mass$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.eye_mcmcglmm_mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.eye_mcmcglmm_mass$Sol[, 1:tadpole.eye_mcmcglmm_mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.eye_mcmcglmm_mass$VCV)

# Look at summary of fixed effect results
summary(tadpole.eye_mcmcglmm_mass)

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.eye_mcmcglmm_mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.eye_mcmcglmm_mass$VCV)

# Get DIC of model
tadpole.eye_mcmcglmm_mass$DIC

# Get lambda
lambda.tad.eye.mass <- tadpole.eye_mcmcglmm_mass$VCV[,'Species_ID']/
          (tadpole.eye_mcmcglmm_mass$VCV[,'Species_ID'] + tadpole.eye_mcmcglmm_mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.tad.eye.mass)

# Posterior mode of lambda
posterior.mode(lambda.tad.eye.mass)

# HPD interval
HPDinterval(lambda.tad.eye.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.tad.eye.mass), aes(x = lambda.tad.eye.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.tad.eye.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.eye.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.eye.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.eye_mcmcglmm_mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_eyes),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.eye_mcmcglmm_mass_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.eye_mcmcglmm_mass_alt$VCV)
HPDinterval(tadpole.eye_mcmcglmm_mass_alt$VCV)
```

#### Adults
```{r tadeye-eye-mass, cache = TRUE, fig.height = 10}

# eye mean vs. cuberoot mass * tad eye position with species identity and phylogeny as random effects.
adult.eye_mcmcglmm_mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_eyes),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.eye_mcmcglmm_mass$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.eye_mcmcglmm_mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.eye_mcmcglmm_mass$Sol[, 1:adult.eye_mcmcglmm_mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.eye_mcmcglmm_mass$VCV)

# Look at summary of fixed effect results
summary(adult.eye_mcmcglmm_mass)

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.eye_mcmcglmm_mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.eye_mcmcglmm_mass$VCV)

# Get DIC of model
adult.eye_mcmcglmm_mass$DIC

# Get lambda
lambda.ad.eye.mass <- adult.eye_mcmcglmm_mass$VCV[,'Species_ID']/
          (adult.eye_mcmcglmm_mass$VCV[,'Species_ID'] + adult.eye_mcmcglmm_mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.eye.mass)

# Posterior mode of lambda
posterior.mode(lambda.ad.eye.mass)

# HPD interval
HPDinterval(lambda.ad.eye.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.eye.mass), aes(x = lambda.ad.eye.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.eye.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.eye.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.eye.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.eye_mcmcglmm_mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_eyes),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.eye_mcmcglmm_mass_alt)$solutions

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.eye_mcmcglmm_mass_alt$VCV)
HPDinterval(adult.eye_mcmcglmm_mass_alt$VCV)
```

## Tadpole mouth position

### Eye size vs. svl x tadpole mouth position

#### Tadpoles
```{r tadmouth-tad-svl, cache = TRUE, fig.height=10}

# eye mean vs. SVL * tadpole mouth position with species identity and phylogeny as random effects.
tadpole.mouth_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_mouth),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.mouth_mcmcglmm$Sol)  


# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.mouth_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.mouth_mcmcglmm$Sol[, 1:tadpole.mouth_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.mouth_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(tadpole.mouth_mcmcglmm)

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.mouth_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.mouth_mcmcglmm$VCV)

# Get DIC of model
tadpole.mouth_mcmcglmm$DIC

# Get lambda
lambda.mouth.hab <- tadpole.mouth_mcmcglmm$VCV[,'Species_ID']/
          (tadpole.mouth_mcmcglmm$VCV[,'Species_ID'] + tadpole.mouth_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.mouth.hab)

# Posterior mode of lambda
posterior.mode(lambda.mouth.hab)

# HPD interval
HPDinterval(lambda.mouth.hab)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.mouth.hab), aes(x = lambda.mouth.hab))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.mouth.hab), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.mouth.hab)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.mouth.hab)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.mouth_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_mouth),
                   data = tads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.mouth_mcmcglmm_alt)

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.mouth_mcmcglmm_alt$VCV)
HPDinterval(tadpole.mouth_mcmcglmm_alt$VCV)
```

#### Adults
```{r tadmouth-ad-svl, cache = TRUE, fig.height=10}
# eye mean vs. SVL * tadpole mouth position with species identity and phylogeny as random effects.
adult.mouth_mcmcglmm <- MCMCglmm(log10(eyemean) ~ log10(Snout.Vent_length) * as.factor(tad_mouth),
                   data = ads.svl.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.mouth_mcmcglmm$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.mouth_mcmcglmm$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.mouth_mcmcglmm$Sol[, 1:adult.mouth_mcmcglmm$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.mouth_mcmcglmm$VCV)

# Look at summary of fixed effect results
summary(adult.mouth_mcmcglmm)

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.mouth_mcmcglmm$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.mouth_mcmcglmm$VCV)

# Get DIC of model
adult.mouth_mcmcglmm$DIC

# Get lambda
lambda.ad.mouth <- adult.mouth_mcmcglmm$VCV[,'Species_ID']/
          (adult.mouth_mcmcglmm$VCV[,'Species_ID'] + adult.mouth_mcmcglmm$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.mouth)

# Posterior mode of lambda
posterior.mode(lambda.ad.mouth)

# HPD interval
HPDinterval(lambda.ad.mouth)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.mouth), aes(x = lambda.ad.mouth))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.mouth), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.mouth)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.mouth)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.mouth_mcmcglmm_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_mouth),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.mouth_mcmcglmm_alt)

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.mouth_mcmcglmm_alt$VCV)
HPDinterval(adult.mouth_mcmcglmm_alt$VCV)
```

### Eye size vs. mass x tadpole mouth position

#### Tadpoles
```{r tadmouth-tad-mass, cache = TRUE, fig.height=10}

# eye mean vs. cube root mass * tadpole mouth position with species identity and phylogeny as random effects.
tadpole.mouth_mcmcglmm_mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_mouth),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(tadpole.mouth_mcmcglmm_mass$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(tadpole.mouth_mcmcglmm_mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(tadpole.mouth_mcmcglmm_mass$Sol[, 1:tadpole.mouth_mcmcglmm_mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(tadpole.mouth_mcmcglmm_mass$VCV)

# Look at summary of fixed effect results
summary(tadpole.mouth_mcmcglmm_mass)

# Look at G-structure and R-structure posterior modes
posterior.mode(tadpole.mouth_mcmcglmm_mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(tadpole.mouth_mcmcglmm_mass$VCV)

# Get DIC of model
tadpole.mouth_mcmcglmm_mass$DIC

# Get lambda
lambda.tad.mouth.mass <- tadpole.mouth_mcmcglmm_mass$VCV[,'Species_ID']/
          (tadpole.mouth_mcmcglmm_mass$VCV[,'Species_ID'] + tadpole.mouth_mcmcglmm_mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.tad.mouth.mass)

# Posterior mode of lambda
posterior.mode(lambda.tad.mouth.mass)

# HPD interval
HPDinterval(lambda.tad.mouth.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.tad.mouth.mass), aes(x = lambda.tad.mouth.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.tad.mouth.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.mouth.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.tad.mouth.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
tadpole.mouth_mcmcglmm_mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_mouth),
                   data = tads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(tadpole.mouth_mcmcglmm_mass_alt)

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(tadpole.mouth_mcmcglmm_mass_alt$VCV)
HPDinterval(tadpole.mouth_mcmcglmm_mass_alt$VCV)
```

#### Adults
```{r tadmouth-ad-mass, cache = TRUE, fig.height = 10}

# eye mean vs. cube root mass * tad mouth position per with species identity and phylogeny as random effects.
adult.mouth_mcmcglmm_mass <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_mouth),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior,
                   nitt = nitt, thin = thin, burnin = burnin)

# Plot model diagnostics for MCMCglmm
# For fixed effects
plot(adult.mouth_mcmcglmm_mass$Sol)  

# Plot model diagnostics for MCMCglmm
# For random effects
plot(adult.mouth_mcmcglmm_mass$VCV)  

# Calculate effective sample size (ESS)
effectiveSize(adult.mouth_mcmcglmm_mass$Sol[, 1:adult.mouth_mcmcglmm_mass$Fixed$nfl, 
                                 drop = FALSE])[[1]]

# Look for autocorrelation
autocorr(adult.mouth_mcmcglmm_mass$VCV)

# Look at summary of fixed effect results
summary(adult.mouth_mcmcglmm_mass)

# Look at G-structure and R-structure posterior modes
posterior.mode(adult.mouth_mcmcglmm_mass$VCV)

# Look at G-structure and R-structure 95% credible intervals
HPDinterval(adult.mouth_mcmcglmm_mass$VCV)

# Get DIC of model
adult.mouth_mcmcglmm_mass$DIC

# Get lambda
lambda.ad.mouth.mass <- adult.mouth_mcmcglmm_mass$VCV[,'Species_ID']/
          (adult.mouth_mcmcglmm_mass$VCV[,'Species_ID'] + adult.mouth_mcmcglmm_mass$VCV[,'units'])

# Posterior mean of lambda
mean(lambda.ad.mouth.mass)

# Posterior mode of lambda
posterior.mode(lambda.ad.mouth.mass)

# HPD interval
HPDinterval(lambda.ad.mouth.mass)

#plot posterior, with mode and 95% credible interval
ggplot(as.data.frame(lambda.ad.mouth.mass), aes(x = lambda.ad.mouth.mass))+
  geom_density() +
  geom_vline(xintercept = posterior.mode(lambda.ad.mouth.mass), colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.mouth.mass)[[1]], 
             linetype = "dotted", colour = "red") +
  geom_vline(xintercept = HPDinterval(lambda.ad.mouth.mass)[[2]], 
             linetype = "dotted", colour = "red") +
  theme_bw()

#alt model with different priors (sensitivity check)
adult.mouth_mcmcglmm_mass_alt <- MCMCglmm(log10(eyemean) ~ log10(rootmass_mass) * as.factor(tad_mouth),
                   data = ads.mass.traits, 
                   random = ~ Species_ID + genus_species,
                   ginverse = list(Species_ID = inv.phylo), 
                   prior = prior_alt,
                   nitt = nitt, thin = thin, burnin = burnin)

# Fixed effects results
summary(adult.mouth_mcmcglmm_mass_alt)

# Look at G-structure and R-structure 95% credible intervals
posterior.mode(adult.mouth_mcmcglmm_mass_alt$VCV)
HPDinterval(adult.mouth_mcmcglmm_mass_alt$VCV)
```

# Visualize slope differences among ecological states

```{r}
#make a dataframe of ols estimates from ontogenetic allometry for each species

#species names
species <- levels(frogs$genus_species)

#adult intercepts
adult_int <-c(ols_aubria.mass$coefficients["(Intercept)"],
              ols_bufo.mass$coefficients["(Intercept)"],
              ols_hemisus.mass$coefficients["(Intercept)"],
              ols_hyla.mass$coefficients["(Intercept)"],
              ols_kaloula.mass$coefficients["(Intercept)"],
              ols_leptopelis.mass$coefficients["(Intercept)"],
              ols_microhyla.mass$coefficients["(Intercept)"],
              ols_polypedates.mass$coefficients["(Intercept)"],
              ols_pseudis.mass$coefficients["(Intercept)"],
              ols_rana.mass$coefficients["(Intercept)"],
              ols_trichobatrachus.mass$coefficients["(Intercept)"],
              ols_xenopus.mass$coefficients["(Intercept)"])

names(adult_int) <- species

#adult slopes
adult_slope <- c(ols_aubria.mass$coefficients["log10(rootmass_mass)"],
              ols_bufo.mass$coefficients["log10(rootmass_mass)"],
              ols_hemisus.mass$coefficients["log10(rootmass_mass)"],
              ols_hyla.mass$coefficients["log10(rootmass_mass)"],
              ols_kaloula.mass$coefficients["log10(rootmass_mass)"],
              ols_leptopelis.mass$coefficients["log10(rootmass_mass)"],
              ols_microhyla.mass$coefficients["log10(rootmass_mass)"],
              ols_polypedates.mass$coefficients["log10(rootmass_mass)"],
              ols_pseudis.mass$coefficients["log10(rootmass_mass)"],
              ols_rana.mass$coefficients["log10(rootmass_mass)"],
              ols_trichobatrachus.mass$coefficients["log10(rootmass_mass)"],
              ols_xenopus.mass$coefficients["log10(rootmass_mass)"])

names(adult_slope) <- species

#tadpole intercepts
tad_int <-c(ols_aubria.mass$coefficients["(Intercept)"] + ols_aubria.mass$coefficients["gosner_categorytadpole"],
              ols_bufo.mass$coefficients["(Intercept)"] + ols_bufo.mass$coefficients["gosner_categorytadpole"],
              ols_hemisus.mass$coefficients["(Intercept)"] + ols_hemisus.mass$coefficients["gosner_categorytadpole"],
              ols_hyla.mass$coefficients["(Intercept)"] + ols_hyla.mass$coefficients["gosner_categorytadpole"],
              ols_kaloula.mass$coefficients["(Intercept)"] + ols_kaloula.mass$coefficients["gosner_categorytadpole"],
              ols_leptopelis.mass$coefficients["(Intercept)"] + ols_leptopelis.mass$coefficients["gosner_categorytadpole"],
              ols_microhyla.mass$coefficients["(Intercept)"] + ols_microhyla.mass$coefficients["gosner_categorytadpole"],
              ols_polypedates.mass$coefficients["(Intercept)"] + ols_polypedates.mass$coefficients["gosner_categorytadpole"],
              ols_pseudis.mass$coefficients["(Intercept)"] + ols_pseudis.mass$coefficients["gosner_categorytadpole"],
              ols_rana.mass$coefficients["(Intercept)"] + ols_rana.mass$coefficients["gosner_categorytadpole"],
              ols_trichobatrachus.mass$coefficients["(Intercept)"] + ols_trichobatrachus.mass$coefficients["gosner_categorytadpole"],
              ols_xenopus.mass$coefficients["(Intercept)"] + ols_xenopus.mass$coefficients["gosner_categorytadpole"])

names(tad_int) <- species

#tadpole slopes
tad_slope <- c(ols_aubria.mass$coefficients["log10(rootmass_mass)"] + ols_aubria.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_bufo.mass$coefficients["log10(rootmass_mass)"] + ols_bufo.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_hemisus.mass$coefficients["log10(rootmass_mass)"] + ols_hemisus.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_hyla.mass$coefficients["log10(rootmass_mass)"] + ols_hyla.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_kaloula.mass$coefficients["log10(rootmass_mass)"] + ols_kaloula.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_leptopelis.mass$coefficients["log10(rootmass_mass)"] + ols_leptopelis.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_microhyla.mass$coefficients["log10(rootmass_mass)"] + ols_microhyla.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_polypedates.mass$coefficients["log10(rootmass_mass)"] + ols_polypedates.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_pseudis.mass$coefficients["log10(rootmass_mass)"] + ols_pseudis.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_rana.mass$coefficients["log10(rootmass_mass)"] + ols_rana.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_trichobatrachus.mass$coefficients["log10(rootmass_mass)"] + ols_trichobatrachus.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"],
              ols_xenopus.mass$coefficients["log10(rootmass_mass)"] + ols_xenopus.mass$coefficients["log10(rootmass_mass):gosner_categorytadpole"])

names(tad_slope) <- species

#join by name with trait data
slope_trait <- traits
slope_trait$adult_slope <- adult_slope[slope_trait$genus_species]
slope_trait$adult_int <- adult_int[slope_trait$genus_species]
slope_trait$tad_slope <- tad_slope[slope_trait$genus_species]
slope_trait$tad_int <- tad_int[slope_trait$genus_species] 

slope_trait$adult_hab_bin <- recode_factor(slope_trait$adult_hab_bin, "aquatic-fossorial"="aq/foss", "terrestrial"="other")
```

## OLS slopes across ecological states
```{r eco-boxplots, results = "hide"}
#Make boxplots showing slope distribution across ecological states

#Color vectors for stages
col_stage <- c("adult" = "#009E73",
               "tadpole" = "#56B4E9")

#Convert data to long format (scaling with mass)
slope_mass_long <- slope_trait %>%
  pivot_longer(cols = c(tad_slope, adult_slope),
               names_to = "life_stage",
               values_to = "slope.mass") %>%
  mutate(life_stage = recode_factor(life_stage, "tad_slope" = "tadpole", "adult_slope" = "adult")) %>%
  select(genus_species, life_stage, slope.mass, adult_hab_bin, adult_activity, tad_microhab, tad_mouth, tad_eyes)

#Plot for tadpole and adult slopes by tadpole microhabitat-----

#tadpole microhabitat mass
microhab.tad <- ggplot(data = slope_mass_long,
                    aes(x = tad_microhab, y = slope.mass, fill = life_stage),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position = position_dodge(width=0.8), shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
  scale_fill_manual(values = col_stage,
                    breaks = c("tadpole",
                                "adult"),
                    labels = c("tadpole",
                                "adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
  xlab("Tadpole microhabitat") +
  ylab("Slope") +
  labs(fill = "Life Stage")

microhab.tad


#Plots for tadpole and slopes by tadpole eye position-----

#eye position mass
eyepos.tad <- ggplot(data = slope_mass_long,
                    aes(x = tad_eyes, y = slope.mass, fill = life_stage),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position=position_dodge(width=0.8),             shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
  scale_fill_manual(values = col_stage) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
  xlab("Tadpole eye position") +
  ylab("Slope") +
  labs(fill = "Life Stage")

eyepos.tad

#Plots for tadpole and adult slopes by tadpole mouth position-----

#mouth position mass
mouthpos.tad <- ggplot(data = slope_mass_long,
                    aes(x = tad_mouth, y = slope.mass, fill = life_stage),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position=position_dodge(width=0.8),             shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
  scale_fill_manual(values = col_stage) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
  xlab("Tadpole mouth position") +
  ylab("Slope") +
  labs(fill = "Life Stage")

mouthpos.tad

#Plots for tadpole and slopes by adult microhabitat-----

#adult microhabitat mass
microhab.ad <- ggplot(data = slope_mass_long,
                    aes(x = factor(adult_hab_bin, level = c("other", "aq/foss")), y = slope.mass, fill = life_stage),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position=position_dodge(width=0.8),             shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
  scale_fill_manual(values = col_stage) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
  xlab("Adult microhabitat") +
  ylab("Slope") +
  labs(fill = "Life Stage")

microhab.ad

#Plots for tadpole and adult slopes by adult activity period-----

#adult activity period mass
activity.ad <- ggplot(data = slope_mass_long,
                    aes(x = factor(adult_activity, level = c("nocturnal", "both")), y = slope.mass, fill = life_stage),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position=position_dodge(width=0.8), shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
  scale_fill_manual(values = col_stage) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
  xlab("Adult activity period") +
  ylab("Slope") +
  labs(fill = "Life Stage")

activity.ad

```

## Eye size across life stages and ecological states

Here, we generate plots and summary statistics for mean absolute eye diameters and relative eye sizes (compared to body size) across life stages. We have plotted both our original life stage categories (tadpole, metamorph, adult) and, because tadpoles show higher slopes than adults and should change relative eye size more throughout development, life stages with tadpoles split by Gosner stage into early tadpoles (Gosner stage 22-30) and late tadpoles (Gosner stage = 31-40). 

```{r eyesize-data}

#create dataframe with means for tadpoles and adults------

#make dataframe of eye size means across life stages
sizes <- frogs %>%
  mutate(releye_mass = eyemean/rootmass_mass) %>% #eye size relative to mass
  mutate(releye_svl = eyemean/Snout.Vent_length)  %>% #eye size relative to SVL
  mutate_if(is.character, as.factor) %>% 
  filter(!(is.na(gosner_category))) %>%
  group_by(genus_species, gosner_category) %>%
  summarise(eye_av = mean(eyemean, na.rm=TRUE), 
            svl_av = mean(Snout.Vent_length, na.rm=TRUE), 
            mass_av = mean(rootmass_mass, na.rm=TRUE), 
            rel_mass = mean(releye_mass,na.rm=TRUE), 
            rel_svl = mean(releye_svl, na.rm=TRUE), 
            n = n())

#add in ecological traits
sizes_traits <- left_join(sizes, traits, by = "genus_species") %>%
 mutate(gosner_category = factor(gosner_category, levels = c("tadpole", "metamorph", "adult")))


#create dataframe with means for early/late tadpoles and adults------

#make dataframe of eye size means across life stages with tadpoles spllit (tadpoles are stage 22-40, so early tads = 22-30 and late tads = 31-40)

#make dataframe of eye size means across split stages
sizes_split <- frogs %>%
  mutate(dev_stage = case_when(Gosner_Scale < 31 ~ "early_tad",
                               Gosner_Scale >= 31 & Gosner_Scale <= 40 ~ "late_tad",
                               Gosner_Scale > 40 & Gosner_Scale < 46 ~ "metamorph",
                               Gosner_Scale == 46 ~ "adult")) %>%
  mutate(releye_mass = eyemean/rootmass_mass) %>%
  mutate(releye_svl = eyemean/Snout.Vent_length) %>%
  mutate_if(is.character, as.factor) %>% 
  filter(!(is.na(dev_stage))) %>%
  group_by(genus_species, dev_stage) %>%
  summarise(eye_av = mean(eyemean,na.rm=TRUE), 
            svl_av = mean(Snout.Vent_length,na.rm=TRUE), 
            mass_av = mean(rootmass_mass,na.rm=TRUE), 
            rel_mass = mean(releye_mass,na.rm=TRUE), 
            rel_svl = mean(releye_svl,na.rm=TRUE), 
            n = n())

#add in traits
sizes_traits_split <- left_join(sizes_split, traits, by = "genus_species") %>% 
  mutate(dev_stage = factor(dev_stage, levels = c("early_tad", "late_tad", "metamorph", "adult")))
```

### Plots of absolute and relative eye size 
```{r sizes-plots}

#colors
col_3stage <- c("adult" = "#009E73", 
          "metamorph" = "darkorange",
          "tadpole" = "#56B4E9")

#Boxplots for absolute eye size across life stages -----
abseye_plot <- ggplot(data = sizes_traits, aes(x = gosner_category, y = eye_av, fill = gosner_category, text = genus_species)) + 
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour = "black", geom = "point", shape = 18, size = 3, show_guide = FALSE) + #controls what stats shown
 geom_jitter(shape = 19, size = 1.3, alpha = 0.5, position = position_jitter(0.15)) +
  scale_fill_manual(values = col_3stage,
                    breaks = c("tadpole",
                                "metamorph",
                                "adult"),
                    labels = c("Tadpole",
                                "Metamorph",
                                "Adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
  xlab("Stage") +
  scale_y_log10("Mean diameter (mm)") +
  labs(fill = "Stage")

ggplotly(abseye_plot)

#Boxplots for relative eye investment across life stages (mass)
relmass_plot <- ggplot(data = sizes_traits, aes(x = gosner_category, y = rel_mass, fill = gosner_category, text = genus_species)) + 
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour = "black", geom = "point", shape = 18, size = 3, show_guide = FALSE) + #controls what stats shown
 geom_jitter(shape = 19, size = 1.3, alpha = 0.5, position = position_jitter(0.15)) +
  scale_fill_manual(values = col_3stage,
                    breaks = c("tadpole",
                                "metamorph",
                                "adult"),
                    labels = c("Tadpole",
                                "Metamorph",
                                "Adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
  xlab("Stage") +
  ylab("Relative eye size (ED/RM)") +
  labs(fill = "Stage")

ggplotly(relmass_plot)

#Boxplots for relative eye size across life stages (SVL)
relsvl_plot <- ggplot(data = sizes_traits, aes(x = gosner_category, y = rel_svl, fill = gosner_category, text = genus_species)) + 
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour = "black", geom = "point", shape = 18, size = 3, show_guide = FALSE) + #controls what stats shown
 geom_jitter(shape = 19, size = 1.3, alpha = 0.5, position = position_jitter(0.15)) +
 scale_fill_manual(values = col_3stage,
                    breaks = c("tadpole",
                                "metamorph",
                                "adult"),
                    labels = c("Tadpole",
                                "Metamorph",
                                "Adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
  xlab("Stage") +
  ylab("Relative eye size (ED/SVL)") +
  labs(fill = "Stage")

ggplotly(relsvl_plot)


#Boxplots for eye size of tadpoles split into early and late stage------

#Color pallette for split tadpole life stages
col_stages <- c("adult" = "#009E73",
                "metamorph" = "darkorange",
               "late_tad" = "#1c93d7",
               "early_tad" = "#9ad2f2")

#Boxplots for absolute eye size across life stages
abseye_plot_split <- ggplot(data = sizes_traits_split, aes(x = dev_stage, y = eye_av, fill = dev_stage)) + 
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour = "black", geom = "point", shape = 18, size = 3, show_guide = FALSE) + #controls what stats shown
 geom_jitter(shape = 19, size = 1.3, alpha = 0.5, position = position_jitter(0.15)) +
  scale_fill_manual(values = col_stages,
                    breaks = c("early_tad",
                                "late_tad",
                                "metamorph",
                                "adult"),
                    labels = c("Early tadpole",
                                "Late tadpole",
                               "Metamorph",
                                "Adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x=element_blank(), axis.ticks.x=element_blank()) + 
  xlab(" ") +
  scale_y_log10("Eye diameter (mm)") +
  labs(fill = "Life stage")

ggplotly(abseye_plot_split)

#Boxplots for relative eye size across life stages (mass)
relmass_plot_split <- ggplot(data = sizes_traits_split, aes(x = dev_stage, y = rel_mass, fill = dev_stage)) + 
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour = "black", geom = "point", shape = 18, size = 3, show_guide = FALSE) + #controls what stats shown
 geom_jitter(shape = 19, size = 1.3, alpha = 0.5, position = position_jitter(0.15)) +
  scale_fill_manual(values = col_stages,
                    breaks = c("early_tad",
                                "late_tad",
                                "metamorph",
                                "adult"),
                    labels = c("Early tadpole",
                                "Late tadpole",
                               "Metamorph",
                                "Adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x=element_blank(), axis.ticks.x=element_blank()) + 
  xlab("") +
  ylab("Relative eye size (mass)") +
  labs(fill = "Life stage")

ggplotly(relmass_plot_split)

#Boxplots for relative eye size across life stages (SVL)
relsvl_plot_split <- ggplot(data = sizes_traits_split, aes(x = dev_stage, y = rel_svl, fill = dev_stage)) + 
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour = "black", geom = "point", shape = 18, size = 3, show_guide = FALSE) + #controls what stats shown
 geom_jitter(shape = 19, size = 1.3, alpha = 0.5, position = position_jitter(0.15)) +
  scale_fill_manual(values = col_stages,
                    breaks = c("early_tad",
                                "late_tad",
                                "metamorph",
                                "adult"),
                    labels = c("Early tadpole",
                                "Late tadpole",
                               "Metamorph",
                                "Adult")) +
   theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x=element_blank(), axis.ticks.x=element_blank()) + 
  xlab(" ") +
  ylab("Relative eye size (SVL)") +
  labs(fill = "Life stage")

ggplotly(relsvl_plot_split)

```

### Summary statistics for absolute and relative eye size

```{r sum-stats-eyesize}

# Summary stats for eye size across stages ------
lifestage.stats <- ddply(sizes_traits, ~gosner_category, summarise, 
                   mean.eye = round(mean(eye_av, na.rm = TRUE), digits = 2), 
                   sd.eye=round(sd(eye_av, na.rm = TRUE), digits = 2), 
                   n.eye=length(eye_av[!is.na(eye_av)]), 
                   mean.rel_mass = round(mean(rel_mass, na.rm = TRUE), digits = 2),
                   sd.rel_mass = round(sd(rel_mass, na.rm = TRUE), digits = 2),
                   n.rel_mass = length(rel_mass[!is.na(rel_mass)]), 
                   mean.rel_svl = round(mean(rel_svl, na.rm = TRUE), digits = 2),
                   sd.rel_svl = round(sd(rel_svl, na.rm = TRUE), digits = 2),
                   n.rel_svl=length(rel_svl[!is.na(rel_svl)]))

lifestage <- lifestage.stats %>%
  select(gosner_category, mean.eye, sd.eye, mean.rel_mass, sd.rel_mass, mean.rel_svl, sd.rel_svl, n.rel_svl)

#create table column names
names(lifestage) <- c("Life stage", "Mean eye diam. (mm)", "SD eye diameter", "Mean eye/mass", "SD eye/mass", "Mean eye/SVL", "SD eye/SVL","n") 

#generate scrolling table in RMarkdown
kable(lifestage[ , c("Life stage", "Mean eye diam. (mm)", "SD eye diameter", "Mean eye/mass", "SD eye/mass", "Mean eye/SVL", "SD eye/SVL","n")], caption = "Summary statistics for absolute and relative eye size by life stage") %>% 
                      kable_styling(full_width = F) %>% 
                      collapse_rows(columns = 1, valign = "top") %>%
                      scroll_box(height = "400px") 

# Summary stats for eye size across stages with tadpoles split (early/late) ------

lifestage.stats_split <- ddply(sizes_traits_split, ~dev_stage, summarise, 
                   mean.eye = round(mean(eye_av, na.rm = TRUE), digits = 2), 
                   sd.eye=round(sd(eye_av, na.rm = TRUE), digits = 2), 
                   n.eye=length(eye_av[!is.na(eye_av)]), 
                   mean.rel_mass = round(mean(rel_mass, na.rm = TRUE), digits = 2),
                   sd.rel_mass = round(sd(rel_mass, na.rm = TRUE), digits = 2),
                   n.rel_mass = length(rel_mass[!is.na(rel_mass)]), 
                   mean.rel_svl = round(mean(rel_svl, na.rm = TRUE), digits = 2),
                   sd.rel_svl = round(sd(rel_svl, na.rm = TRUE), digits = 2),
                   n.rel_svl=length(rel_svl[!is.na(rel_svl)]))

lifestage_split <- lifestage.stats_split %>%
  select(dev_stage, mean.eye, sd.eye, mean.rel_mass, sd.rel_mass, mean.rel_svl, sd.rel_svl, n.rel_svl) %>%
  mutate(dev_stage = recode_factor(dev_stage, "early_tad" = "early tadpole", "late_tad" = "late tadpole"))

#create table column names
names(lifestage_split) <- c("Life stage", "Mean eye diam. (mm)", "SD eye diameter", "Mean eye/mass", "SD eye/mass", "Mean eye/SVL", "SD eye/SVL","n") 

#generate scrolling table in RMarkdown
kable(lifestage_split[ , c("Life stage", "Mean eye diam. (mm)", "SD eye diameter", "Mean eye/mass", "SD eye/mass", "Mean eye/SVL", "SD eye/SVL","n")], caption = "Summary statistics for absolute and relative eye size by life stage (tadpoles split into early vs. late)") %>% 
                      kable_styling(full_width = F) %>% 
                      collapse_rows(columns = 1, valign = "top") %>%
                      scroll_box(height = "400px") 

```

### Plots of eye size across tadpole microhabitat

Here, we plot mean relative eye size across developmental stages (split into early vs. late tadpoles, metamorphs, adults). We look at this only for tadpole microhabitat, as this had a significant effect on tadpole eye-body allometric slopes. s

```{r tadmicro-rel-eye}

#Plot for differences in relative eye size across benthic/nektonic tadpoles -----

#Boxplots for (mass) relative eye size across life stages and tadpole microhabs 
relmass_plot_microhab <- ggplot(data = sizes_traits,
                    aes(x = tad_microhab, y = rel_mass, fill = gosner_category),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position=position_dodge(width=0.8),             shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
  scale_fill_manual(values = col_3stage) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
 xlab("Tadpole microhabitat") +
  ylab("Relative eye size (ED/RM)") +
  labs(fill = "Life Stage")

relmass_plot_microhab

#Plot for differences in relative eye size across early stage and late stage benthic/nektonic tadpoles -----

#Boxplots for relative eye size across life stages (mass)
relmass_plot_microhab_split <- ggplot(data = sizes_traits_split,
                    aes(x = tad_microhab, y = rel_mass, fill = dev_stage),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position=position_dodge(width=0.8),             shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
  scale_fill_manual(values = col_stages, 
                    name = "Life Stage", 
                    breaks = c("early_tad", "late_tad", "metamorph", "adult"),
                    labels = c("early tadpole", "late tadpole", "metamorph", "adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
 xlab("Tadpole microhabitat") +
  ylab("Relative eye size (mass)")

relmass_plot_microhab_split

#Boxplots for relative eye size across life stages (SVL)
relsvl_plot_microhab_split <- ggplot(data = sizes_traits_split,
                    aes(x = tad_microhab, y = rel_svl, fill = dev_stage),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position=position_dodge(width=0.8),             shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
  scale_fill_manual(values = col_stages, 
                    name = "Life Stage", 
                    breaks = c("early_tad", "late_tad", "metamorph", "adult"),
                    labels = c("Early tadpole", "Late tadpole", "Metamorph", "Adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
 xlab("Tadpole microhabitat") +
  ylab("Relative eye size (SVL)")

relsvl_plot_microhab_split

#Boxplot for absolute eye size across life stages 
eye_microhab_split <- ggplot(data = sizes_traits_split,
                    aes(x = tad_microhab, y = eye_av, fill = dev_stage),
                    position = position_dodge(0.8)) + # control space between box plots
  geom_boxplot(notch = FALSE, outlier.shape = NA, alpha = 0.6) + #controls boxes
  stat_summary(fun.y = mean, colour="black", geom="point", position=position_dodge(width=0.8),             shape=18, size=3, show_guide = FALSE) + #controls what stats shown
  geom_point(position=position_jitterdodge(), alpha=0.5) + #this fixed the point distribution
   scale_fill_manual(values = col_stages, 
                    name = "Life Stage", 
                    breaks = c("early_tad", "late_tad", "metamorph", "adult"),
                    labels = c("Early tadpole", "Late tadpole", "Metamorph", "Adult")) +
  theme(text = element_text(size=14), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #controls background
 xlab("Tadpole microhabitat") +
  ylab("Eye diameter (mm)")

eye_microhab_split

```

### Statistical tests for eye size across tadpole microhabitats

We then used Kruskal-Wallis tests to determine whether each life stage showed siginificant differences in eye size or relative eye size across tadpole microhabitats (benthic/nektonic)

#### Eye diameter

```{r abs-eye-stats}

# 'Kruskall Wallis tests' for differences in absolute eye sizes at each stage across tadpole microhabitats

#early tadpoles
etads <- sizes_traits_split %>% filter(dev_stage == "early_tad")
kruskal.test(etads$eye_av~etads$tad_microhab)

#late tadpoles
ltads <- sizes_traits_split %>% filter(dev_stage == "late_tad")
kruskal.test(ltads$eye_av~ltads$tad_microhab)

#adults
ads <- sizes_traits_split %>% filter(dev_stage == "adult")
kruskal.test(ads$eye_av~ads$tad_microhab)
```

#### Relative eye size (mass)

```{r releye-mass-stats}

# 'Kruskall Wallis tests' for differences in relative eye sizes at each stage across tadpole microhabitats

#early tadpoles
etads <- sizes_traits_split %>% filter(dev_stage == "early_tad")
kruskal.test(etads$rel_mass~etads$tad_microhab)

#late tadpoles
ltads <- sizes_traits_split %>% filter(dev_stage == "late_tad")
kruskal.test(ltads$rel_mass~ltads$tad_microhab)

#adults
ads <- sizes_traits_split %>% filter(dev_stage == "adult")
kruskal.test(ads$rel_mass~ads$tad_microhab)
```

#### Relative eye size (SVL)

```{r releye-svl-stats}

# 'Kruskall Wallis tests' for differences in relative eye sizes at each stage across tadpole microhabitats

#early tadpoles
etads <- sizes_traits_split %>% filter(dev_stage == "early_tad")
kruskal.test(etads$rel_svl~etads$tad_microhab)

#late tadpoles
ltads <- sizes_traits_split %>% filter(dev_stage == "late_tad")
kruskal.test(ltads$rel_svl~ltads$tad_microhab)

#adults
ads <- sizes_traits_split %>% filter(dev_stage == "adult")
kruskal.test(ads$rel_svl~ads$tad_microhab)
```

## Figure for slopes and relative eye sizes across ecological states

### Figure 4
```{r Figure-4, fig.width=10, fig.height=8, results = "hide"}
# Construct Figure 4

#make panels
fig.a <- microhab.tad + theme(legend.position = "none")
fig.b <- eyepos.tad + theme(legend.position = "none")
fig.c <- microhab.ad + theme(legend.position = "none")

fig.d <- relmass_plot_split + 
  theme(legend.position = "none") +
  xlab("Life stage")
fig.e <- relmass_plot_microhab_split + theme(legend.position = "none")

#use cowplot package to put together A-C panels
plots1 <- plot_grid(fig.a, fig.b, fig.c, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           labels = c("A", "B", "C"), #panel labels for figure
           hjust = -0.5, #adjustment for panel labels
           nrow = 1) #number of columns in grids

#use cowplot package to nicely plot the graphs together with a shared common legend.
plots2 <- plot_grid(fig.d, fig.e, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           labels = c("D", "E"), #panel labels for figure
           hjust = -0.5, #adjustment for panel labels
           ncol = 2,
           rel_widths = c(0.5,1)) #number of columns in grids


#extract legends from plots
leg1 <- get_legend(microhab.tad + theme(legend.position = "right")  )
leg2 <- get_legend(relmass_plot_microhab_split + theme(legend.position = "right"))

#combine figure panels and legends
plots <- plot_grid(plots1, leg1, plots2, leg2, #list of plots to arrange in grid
           align = 'vh', #align horizontally and vertically
           ncol = 2,
           rel_widths = c(1, 0.2)) #number of columns in grids


#print figure
plot_grid(plots)

#export pdf of figure
png("../Figures/Figure-4.png", width = 10, height = 8, units = "in", res = 500)
plot_grid(plots)
dev.off()

```